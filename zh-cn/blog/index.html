<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Blog | Seata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://seata.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://seata.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://seata.io/zh-cn/blog"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="keywords" content="Seata,Seata官网,Seata official site,分布式事务,distributed transactions"><meta data-rh="true" property="og:title" content="Blog | Seata"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/zh-cn/img/seata_logo_small.jpeg"><link data-rh="true" rel="canonical" href="https://seata.io/zh-cn/blog"><link data-rh="true" rel="alternate" href="https://seata.io/blog" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://seata.io/zh-cn/blog" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://seata.io/blog" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ICHFIJRDZF-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/zh-cn/blog/rss.xml" title="Seata RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-cn/blog/atom.xml" title="Seata Atom Feed">


<link rel="search" type="application/opensearchdescription+xml" title="Seata" href="/zh-cn/opensearch.xml">


<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=seata">
<script src="https://www.googletagmanager.com/gtag/js?id=G-X4LJGF90X2" async></script><link rel="stylesheet" href="/zh-cn/assets/css/styles.d0073205.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.6f01168c.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.603a6742.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>



<script src="https://hm.baidu.com/hm.js?104e73ef0c18b416b27abb23757ed8ee"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-cn/">首页</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/overview/what-is-seata" href="/zh-cn/docs/overview/what-is-seata">v2.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/docs/next/overview/what-is-seata">预览版</a></li><li><a class="dropdown__link" href="/zh-cn/docs/overview/what-is-seata">v2.0</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.8/overview/what-is-seata">v1.8</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.7/overview/what-is-seata">v1.7</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.6/overview/what-is-seata">v1.6</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.5/overview/what-is-seata">v1.5</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.4/overview/what-is-seata">v1.4</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.3/overview/what-is-seata">v1.3</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.2/overview/what-is-seata">v1.2</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.1/overview/what-is-seata">v1.1</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v1.0/overview/what-is-seata">v1.0</a></li></ul></div><a class="navbar__item navbar__link" href="/zh-cn/docs/developers/contributor-guide/new-contributor-guide_dev">开发者</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/blog">博客</a><a class="navbar__item navbar__link" href="/zh-cn/users">用户</a><a class="navbar__item navbar__link" href="/zh-cn/community">社区</a><a class="navbar__item navbar__link" href="/zh-cn/unversioned/download/seata-server">下载</a><a href="http://demo.seata.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">控制台样例</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中</a><ul class="dropdown__menu"><li><a href="/blog" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">En</a></li><li><a href="/zh-cn/blog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/explore-seata-journey">探索 Seata 项目开源开发之旅</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-raft-detailed-explanation">Seata-Raft 存储模式详解及入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-connect-data-and-application">Seata：连接数据与应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-observable-practice">Seata的可观测实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-go-1.2.0">生产环境可用的 seata-go 1.2.0 来了！！！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/iscas2023">6大课题现已开放挑选 | 欢迎报名 Seata 开源之夏</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-1.6.0">Seata 1.6.0 重磅发布，大幅提升性能</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-1.5.2">Seata 1.5.2 重磅发布，支持xid负载均衡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-tcc-fence">阿里 Seata 新版本终于解决了 TCC 模式的幂等、悬挂和空回滚问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-tcc">深度剖析 Seata TCC 模式（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-lock">详解 Seata AT 模式事务隔离级别与全局锁设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-snowflake-explain">关于新版雪花算法的答疑</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-UUID-generator">Seata基于改良版雪花算法的分布式UUID生成器分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-feature-undo-log-compress">Seata新特性支持 -- undo_log压缩</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-dsproxy-deadlock">ConcurrentHashMap导致的Seata死锁问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-client-start-analysis-02">Seata应用侧启动过程剖析——注册中心与配置中心模块</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-client-start-analysis-01">Seata应用侧启动过程剖析——RM &amp; TM如何与TC建立连接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/integrate-seata-tcc-mode-with-spring-cloud">Spring Cloud集成Seata分布式事务-TCC模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-config-manager">Seata配置管理原理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-golang-communication-mode">seata-golang 通信模型详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-datasource-proxy">Seata数据源代理解析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-sourcecode-client-bootstrap">分布式事务Seata源码-Client端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-demo-in-mac">Mac下的Seata Demo环境搭建（AT模式）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-rpc-refactor">Seata RPC 模块的重构之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-sourcecode-server-bootstrap">分布式事务Seata源码-Server端启动流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-xa-introduce">分布式事务如何实现？深入解读 Seata 的 XA 模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-quick-start">Seata 极简入门</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-ha-practice">Seata 高可用部署实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-config-modular">Seata config 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-dubbo-transmit-xid">源码分析Seata-XID传递 Dubbo篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-tcc-modular">Seata tcc 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-community-meetup-hangzhou-ready">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-core-modular">Seata core 模块源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-spring-boot-aop-aspectj">通过AOP动态创建/关闭Seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-dynamic-config-and-dynamic-disable">Seata 动态配置订阅与降级实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-config-center">Seata 配置中心实现原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-nacos-docker">Docker部署Seata与Nacos整合</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-nacos-analysis">Seata分布式事务启用Nacos做配置中心</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-meetup-hangzhou">Seata Community Meetup·杭州站</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-mybatisplus-analysis">透过源码解决SeataAT模式整合Mybatis-Plus失去MP特性的问题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/springboot-dubbo-mybatisplus-seata">SpringBoot+Dubbo+MybatisPlus整合seata分布式事务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-start-rm-tm">Seata 客户端需要同时启动 RM 和 TM 吗？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-start">Seata AT 模式启动源码分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/design-more-flexable-application-by-saga">基于 Seata Saga 设计更有弹性的金融应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-tcc-saga">分布式事务 Seata 及其三种模式详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-at-mode-design">分布式事务中间件 Seata 的设计原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-go-server">Seata分布式Go Server正式开源-TaaS设计简介</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/how-to-support-spring-cloud">Fescar 与 Spring Cloud 集成源码深度剖析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/integrate-seata-with-spring-cloud">Seata（Fescar）分布式事务 整合 Spring Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-java-client">分布式事务之Seata-Client原理及流程详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-java-server">深度剖析一站式分布式事务方案Seata-Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/tcc-mode-applicable-scenario-analysis">TCC适用模型与适用场景分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/tcc-mode-design-principle">TCC 理论及设计实现指南介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/quick-start-use-seata-and-dubbo-services">如何使用Seata保证Dubbo微服务间的一致性</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/seata-analysis-simple">Fescar分布式事务原理解析探秘</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/manual-transaction-mode">MT 模式</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/explore-seata-journey">探索 Seata 项目开源开发之旅</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-27T00:00:00.000Z" itemprop="datePublished">2023年11月27日</time> · <!-- -->阅读需 20 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">尹祥琨-清华大学，Seata 开源之夏学生参与者</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。在今年的开源之夏活动中，我加入了 Apache Seata (Incubator) 社区，完成了开源之夏的课题，并从此一直积极参与社区。我有幸在云栖大会-开发者秀场上分享了我的开发者经验。在本文中，我将与大家分享我在 Seata 社区中的开发者之旅，以及在这个旅程中积累的经验和见解。希望通过我的故事，能够激励更多人踏上这充满挑战和激励的开源之路，为开源社区的繁荣做出自己的贡献。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="相关背景">相关背景<a href="#相关背景" class="hash-link" aria-label="相关背景的直接链接" title="相关背景的直接链接">​</a></h2><p>在正式介绍我的经历之前，我想先提供一些相关的背景信息，以解释为什么我要参与开源以及如何参与开源。关于参与开源的原因，我相信每个人都有不同的动机。以下是我认为一些主要的原因：</p><ul><li><strong>学习</strong>：参与开源使我们有机会为不同组织开发的开源项目做出贡献，与行业专家互动，提供了学习的机会。 </li><li><strong>技能提升</strong>：以我为例，我通常使用 Java 和 Python 进行后端开发。但在参与Seata项目时，我有机会学习Go语言，拓宽了我的后端技术栈。此外作为学生，我很难接触到生产级框架或应用，而开源社区为我提供了这个机会。 </li><li><strong>兴趣</strong>：我身边的朋友都是热衷于开源的，他们享受编程，对开源充满热情。 </li><li><strong>求职</strong>：参与开源可以丰富我们的作品集，为简历增加分量。 </li><li><strong>工作需求</strong>：有时参与开源是为了解决工作中遇到的问题或满足工作需求。 </li></ul><p>这些都是参与开源的原因，对我来说，学习、技能提升和兴趣是我参与开源的主要动机。无论你是在校学生还是在职人员，如果你有参与开源的意愿，不要犹豫，任何人都可以为开源项目做出贡献。年龄、性别、工作和所在地都不重要，关键是你的热情和对开源项目的好奇心。</p><p><strong>我参与开源的契机是参加了中科院软件所举办的开源之夏活动。</strong>	</p><p>开源之夏是一个面向高校开发者的开源活动，社区发布开源项目，学生开发者在导师的指导下完成项目的开发，结项成果贡献给社区，合入社区仓库，获得项目奖金和证书。开源之夏是踏入开源社区的一个绝佳契机，也是我第一次比较正式地接触开源项目，而这个经历为我打开了一扇全新的大门。自此我深刻地认识到参与开源项目的建设，分享自己的技术成果，让更多的开发者能够使用你所贡献的东西，是一件极富乐趣和意义的事情。</p><p>下面我分享的这张图片是开源之夏官方公开的数据，从 2020 年开始参与的社区数量还有学生数量都在逐年增加，活动也是越办越好。可以看到今年的参与的社区项目共有 133 个，每个社区又提供了若干个课题，而每位学生只能选择一个课题。想要在这么多个社区中找到想要参与的社区和适合自己的课题是一个相对复杂的任务。</p><p><img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-ospp-ea3140f489f2794691a5ec30584dc17d.png" width="1736" height="455" class="img_ev3q"></p><p><strong>综合考虑社区的活跃程度、技术栈契合度、新人引导情况等，最终我选择加入 Seata 社区。</strong></p><p>Seata 是一款开源的分布式事务框架，提供了完整的分布式事务解决方案，包括 AT、TCC、Saga 和 XA 事务模式，可支持多种编程语言和数据存储方案。从 19 年开源起到今年已经走过了 <strong>5</strong> 个年头，社区中有超过 <strong>300</strong> 多位贡献者，项目收获了 <strong>24k+</strong> 星标，是一个非常成熟的社区。同时 Seata 兼容 <strong>10</strong> 余种主流 RPC 框架和 RDBMS，与 <strong>20</strong> 多个社区存在集成和被集成的关系，被<strong>几千</strong>家客户应用到业务系统中，可以说是分布式事务解决方案的事实标准。</p><p><img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-apache-0ab436a0c1d070e4d1dbff2df66ea775.png" width="750" height="146" class="img_ev3q"></p><p>2023 年 10 月 29 日，Seata 正式捐赠给了 Apache 软件基金会，成为孵化项目。经过孵化之后，Seata将有望成为首个 Apache 软件基金会的分布式事务框架顶级项目。这次捐赠也将推动 Seata 更广泛地发展，对生态系统的建设产生深远的影响，从而使更多的开发者受益。这个重要的里程碑也为 Seata 带来更广阔的发展空间。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="开发之旅">开发之旅<a href="#开发之旅" class="hash-link" aria-label="开发之旅的直接链接" title="开发之旅的直接链接">​</a></h2><p><strong>介绍完了一些基本情况，后文中我将分享我在 Seata 社区的开发之旅。</strong></p><p>在正式开始开发之前，我进行了许多准备工作。因为 Seata 已经经历了五年的发展，积累了数十万行代码，因此直接参与开发需要一定的上手成本。我分享了一些准备经验，希望能够为大家提供一些启发。</p><ol><li>文档和博客是第一手材料
文档和博客这类的文本材料可以帮助社区新人迅速了解项目背景和代码结构。
首先，官方文档是最主要的参考资料，从这里可以了解到一切官方认为你需要了解的东西。
<img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-docs-481f1fed9d84cd5bf6459048ab08e169.png" width="722" height="146" class="img_ev3q">
博客，仅次于官方文档的材料，一般是开发者或者是深度用户编写的，和文档不同的点在于博客可能会更深入到某个专项上去介绍，比如一些项目的理论模型、项目结构、某个模块的源码分析等等。
<img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-blogs-3a309daa3407d8705311955654df0b21.png" width="722" height="155" class="img_ev3q">
公众号，和博客类似，一般是偏技术性的文章，公众号还有个优点是可以订阅推送，利用碎片时间阅读一些技术。
<img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-pubs-b79d08833dc9443c20d5badd02f46ad1.png" width="722" height="131" class="img_ev3q">
此外，开源社区的一些在线分享或线下 Meetup 公开的幻灯片也是非常有意义的文本资料。
<img loading="lazy" alt="img" src="/zh-cn/assets/images/explore-seata-slides-9d9ec97761879e8d3a74be56c6908a4a.png" width="722" height="115" class="img_ev3q">
除了官方资料之外，还有许多第三方资料可供学习，比如可以通过用户分享的 use cases 了解项目的具体实施和实践；通过第三方社区的集成文档了解项目的生态；还有就是通过第三方的视频教程来学习。但在所有这些资料中，我认为官方文档和博客是最有帮助的。 </li><li>熟悉使用框架
当然刚才说的这些文本资料肯定不需要面面俱到的看完，纸上得来终觉浅，看到感觉差不多明白了就可以去实践了。可以按照官方文档的&quot;Get Started&quot;章节逐步了解项目的基本流程。另一种方法是查找官方提供的示例或演示，构建并运行它们，理解代码和配置的含义，并通过使用项目了解项目的需求、目标以及现有功能和架构。
例如，Seata有一个名为 seata-samples 的仓库，其中包含20多种用例，比如 Seata 和 Dubbo 集成，和 SCA, Nacos 集成的案例，基本可以覆盖到支持的所有场景。</li><li>粗略阅读源代码把握主要逻辑
在准备阶段，粗略地阅读源代码以把握项目的主要逻辑也很重要。了解如何高效地把握项目的主要内容是一个需要长期积累的技能。首先，通过前述的准备步骤，了解项目的概念、交互和流程模型是很有帮助的。
以Seata为例，通过官方文档和实际操作，可以了解Seata事务领域的三个角色：TC（Transaction Coordinator）、TM（Transaction Manager）和 RM（Resource Manager）。TC 作为独立部署的 Server 用于维护全局和分支事务的状态，是 Seata 实现高可用的关键；TM 用于与 TC 交互，定义全局事务的开始、提交或回滚；RM 用于管理分支事务处理的资源，与 TC 交互以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。粗略地了解这些角色之间的交互后，可以更轻松地把握项目的主要逻辑。
<img loading="lazy" alt="img" src="/zh-cn/assets/images/solution-1bdadb80e54074aa3088372c17f0244b.png" width="868" height="473" class="img_ev3q">
脑海里刻下了这些模型的印象，对源码的主干提取就相对得心应手了一些。比如 Seata TC 事务协调者，作为 Server 端，是一个独立于业务部署的单独应用。那为了分析源码，就可以直接在本地把 server 起起来，通过启动类开始追踪。可以分析到一些初始化的逻辑比如服务注册、全局锁的初始化等等。还有可以通过 RPC 的调用来追踪到交互逻辑的代码，比如 TC 是如何对全局事务和分支事务进行持久化，如何驱动全局事务提交或者回滚的。
然而内嵌客户端的框架代码，没有一个启动类入口可以入手分析。那其实可以从一个 sample 入手，找到其对框架代码的引用从而进行阅读。比如 Seata 一个很重要的注解是 <code>GlobalTransaction</code>，用于标识一个全局事务。想要知道 TM 是如何对这个注解分析的，那我们通过 IDE 的搜索功能，找到 <code>GlobalTransaction</code> 的拦截器即可分析其中的逻辑。
还有一个小 tips 分享给大家，往往来说单测注重于单一模块的职能，可以通过阅读单测可以了解一个模块的输入输出、逻辑边界，也可以顺着单测的调用链去阅读代码，也是理解源码一个很重要的手段。 </li></ol><p><strong>万事俱备只欠东风，做完充足的准备，下一步就是区积极参与到社区之中。</strong></p><p>参与的方式也有很多种，最常见的参与方式是查看项目的 Issues 列表，社区通常会为新贡献者标记一些带有特殊标签的 Issue，如“good-first-issue”、“contributions-welcome”和“help-wanted”等。可以通过这些标签筛选感兴趣的任务。</p><p><img loading="lazy" alt="img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu4AAABQCAMAAABxnADUAAACuFBMVEXMztD+/v/y9PX5+vuoq62nqq3////Iy83MztDFyMv29/j988Xw763//vz+//////3o6On9/f7+/PP9+/j///79/Pv7/P7u7/Hu7e399Mr99tX9/v/t6+n5+/3x8vL18/H8+ub+9Mfz8O329cvb4+33+PrJys3y8bLl5ebM09xlXGPAwsjy8a65vML39fPp6+7q5+Tv8vZ4dHX59O359/X6+fjS1trv597h6O7Bv8D19veZh33HxcXFztlycHPOyml5eoD2+v6OfXTh3dm0uL69ydfFyMvj6/O8w8zU09Pu9fvp49xfZXbd2dTO0dVeX2rBxs728OZ0dXvU3umgkYbx7OTMzc+Dc2vFy9Lc4eb8+fPz+PzOysbz6r7i4eBlZW3m28+0vcrZ3N/Rzs27rqDVybzDtanq6amPk5txfZDN2OXi18p/eXWLmKzp8PiDf3vQwrKwpZjJuqvY0MmapLRjYVrq4dba1M9rcHprdol/gop+bGWvoI6CrYXT2eG5p5rF0uJxYmBsbHGDkKe1wtO8ubmcq8FfWVNkbYCvsrjl46bz9vno7vRyeYWqrbKomond0MCjrLv9+e5WWWd+i6CMg36Hh2mXprtsaGepssCEipTw5bqSnrJ1amjRz3fe3Z99fWROUF347sKquMja1ZTIx6d2gZdYTEru7Kqnm5OUuZeRiYasu8/p6L2pnHRERk2Xj4nGxpd6a1iKgFqkssd/eFn68cOzqHjg06ekqbGYnaWvtoyVh2Pr8+zOxLr599yYlZX27r6glGnRwo03ODulpqZvcVeRkXS3uqGdnobg6+Hn4bihwqSanHeUtOmzr67N3s7Gv4Xv79PS1Z+iqYLCt47Asn1uYUysya7V04WwlYx/cnnV5NbE2cZsluG7r4u40bqsxe5Rg9vH2PR+o+Vdi95vmm////+WVYwoAAAA6HRSTlPE////lpb/xMXE///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////E/33mMAAAIABJREFUeNrsm/lTU1kWxyWZeWVBJSQkISwhLAVWEkuBsGhBEQI0g0toBAMoTkhggAFZwhIQCBhZFBRlEwgYBAxEShEUFAgMssgoxNjVFjO0S7dF/zR/x5z7AJcedKRVnMH3TeUldznvJNTnnnfueWHHH3buIETom9DOP+7YSbcgROibEB1CuwVGiNA3IYsdBO6ECNwJESJwJ0SIwP3/SdaU3y9rgphthTude5+0rfGnuMw4fIJcbAhmtg/uj5+Ul5c/f8zctt/XxsHe6pPk0ExE+C1VwtLg4FLzZomk4/ovuP9SfvPp41c3yx9vX9pXoR2Dh5WVXjaGv9PL1nrX2r99WK2/k+mtrOybCQS38GK81NcVHNzVN8jYjBVp13e4dll+CHdu+XM/eAl4cpP0hT78n/lUt8jjTmjRnnV/e4T67sTosxGv38f+eMDp010zM/eEYNYziGrdGt2uxjv4O9c+kx5/vfDA7LpRRF83mBsywLgDg6Bwy5KPpRfBuLrMrE2YxU3uQfouPRnDfA/udnfcCHeLp+X3MfJ9FkYrf/qFgmtodqxUJO+1xTCf2TNv+n3O7n93okL+epTSIDlg+xlw19QewmxQJjO3sKiX6cYA4vmsQRlEeNf5NrPMakwnM442zqERFObn9Hr9nE4/JtPJ5oby9Hqd3mrOfHcRLQcivG+VmNEvuvogvMPhxdIm7HafxxcHuf57DHPbdbbp0IbR/flNFvbqX08x8s1fUZPBIVPsSJhzIptK4fDIuH83Hgnz49GcMGe2m6etGw1mcDlsFseTjsGcOrAh0bzRNG+I1zCH5wHriwej2F6epyPg7vYXXlltDoaxeN577ZxhGMwCUmt6PZh20GBx4PyYM61xFXc3cL1P3XJx1bM3xvBa9UyzBct3PJOQZy9v3AR9H4YnyYtNReeD6xnDi0fGcW9GuBv75YahnsX5NtNy1orJWDboOv+oTWleblsYHjVMLfQYIJz/YHywuLy4ctdkDF1QDvcXGsbbTMaptmc47i4Eh1uVypiDuwZnBvvg2dXN+H24W2CRE+/DnY79CrizVnFXCI82t3YolDEqUlqW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" width="750" height="80" class="img_ev3q"></p><p>除了 Issues，GitHub 还提供了讨论的功能，可以参与一些公开的讨论并获取新的想法。</p><p><img loading="lazy" alt="img" src="data:image/png;base64,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" width="750" height="86" class="img_ev3q"></p><p>此外，社区通常会定期举行会议，比如周会或双周会，可以通过参加这些会议来了解社区的最新进展，提出问题以及与其他社区成员交流。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结与心得">总结与心得<a href="#总结与心得" class="hash-link" aria-label="总结与心得的直接链接" title="总结与心得的直接链接">​</a></h2><p>我加入 Seata 社区最初是通过开源之夏活动。我完成了我的课题，为 Seata Saga 实现了一些新的功能，也做了一系列的优化。但我不止于此，因为在 Seata 的开源经历中我获得了学生生涯中最宝贵的一次开发者体验，在之后的时间我也持续通过上述参与方式持续活跃在社区中。这主要得益于以下几个方面：</p><ol><li><strong>沟通与社交</strong>：导师制度为我提供了重要的支持。在开发过程中，我与我的导师亦夏之间的密切合作对我适应社区文化和工作流程起到了关键作用。他不仅帮助我适应了社区，还为我提供了程序设计的思路，也与我分享了一些在工作中的经验和见解，这些都对我的发展非常有帮助。此外，Seata 社区创始人清铭也提供了很多帮助，包括建立了与其他同学的联系，帮助我进行 Code Review，也为我提供了许多机会。 </li><li><strong>正反馈</strong>：在 Seata 的开发过程中，我经历了一个良性的循环。许多细节为我提供了许多正反馈，例如我的贡献能被用户广泛使用和受益，比如开发得到了社区的认可。这些正反馈加强了我继续在 Seata 社区贡献的意愿。 </li><li><strong>技能提升</strong>：再就是参与 Seata 开发，对我能力的提升也是巨大的。在这里，我能学习到生产级别的代码，包括性能优化，接口设计，边界判断的技巧。可以直接参与一个开源项目的运作，包括项目计划，安排，沟通等。当然还了解一个分布式事务框架是如何设计并实现的。 </li></ol><p>除了这些宝贵的开发者体验，我也从这次经历中体悟到了一些关于参与开源的个人心得，为激励其他有兴趣参与开源社区的同学，我做了简单的总结：</p><ol><li><strong>了解和学习社区文化和价值观</strong>：每个开源社区都有不同的文化和价值观。了解社区的文化和价值观对于成功参与社区至关重要。观察和了解社区其他成员的日常开发和交流方式是学习社区文化的好方法。在社区中要尊重他人的意见和包容不同的观点。 </li><li><strong>敢于迈出第一步</strong>：不要害怕面对困难，迈出第一步是参与开源社区的关键。可以通过领取标有&quot;good-first-issue&quot;等标签的 Issue，编写文档、单元测试等方式来开始。重要的是要克服畏难情绪，积极尝试并学习。 </li><li><strong>对自己的工作要充满信心</strong>：不要怀疑自己的能力。每个人都是从零开始的，没有人天生就是专家。参与开源社区是一个学习和成长的过程，需要不断的实践和积累经验。 </li><li><strong>积极参与讨论，持续学习不同技术</strong>：不要害怕提出问题，无论是关于项目的具体技术还是开发过程中的挑战。同时也不要局限于一个领域。尝试学习和掌握不同编程语言、框架和工具，这可以拓宽技术视野，为项目提供有价值的洞见。 </li></ol><hr><p>通过我的开源之旅，我积累了宝贵的经验和技能，这些不仅帮助我成长为一个更有价值的开发者，也让我深刻地了解了开源社区的力量。然而，我不仅仅是个别的参与者，我代表着 Seata 社区的一部分。Seata 作为一个正在不断成长和演变的开源项目，有着巨大的潜力，同时也面临着新的挑战。因此我要强调 Seata 社区的重要性和未来的潜力，它已经进入 Apache 软件基金会的孵化阶段，这个重要的里程碑将为 Seata 带来更广阔的发展空间。Seata 欢迎更多的开发者和贡献者的加入，让我们共同推动这个开源项目的发展，为分布式事务领域的进步贡献一份力量。</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-raft-detailed-explanation">Seata-Raft 存储模式详解及入门</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-13T00:00:00.000Z" itemprop="datePublished">2023年10月13日</time> · <!-- -->阅读需 24 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">funkye</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><ul><li><a href="#">1. 概述</a></li><li><a href="#">2. 架构介绍</a></li><li><a href="#">3. 使用部署</a></li><li><a href="#">4. 压测对比</a></li><li><a href="#">5. 总结</a></li></ul><h1>1. 概述</h1><p>Seata 是一款开源的分布式事务解决方案，star高达24000+，社区活跃度极高，致力于在微服务架构下提供高性能和简单易用的分布式事务服务.</p><p>目前Seata的分布式事务数据存储模式有file，db，redis，而本篇文章将Seata-Server Raft模式的架构，部署使用，压测对比，及为什么Seata需要Raft,并领略从调研对比,设计,到具体实现,再到知识沉淀的过程.</p><p>分享人：陈健斌（funkye） github id: <a href="https://github.com/funky-eyes" target="_blank" rel="noopener noreferrer">funky-eyes</a></p><h1>2. 架构介绍</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-raft-模式是什么">2.1 Raft 模式是什么？<a href="#21-raft-模式是什么" class="hash-link" aria-label="2.1 Raft 模式是什么？的直接链接" title="2.1 Raft 模式是什么？的直接链接">​</a></h2><p>首先需要明白什么是raft分布式一致性算法,这里直接摘抄sofa-jraft官网的相关介绍:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RAFT 是一种新型易于理解的分布式一致性复制协议，由斯坦福大学的 Diego Ongaro 和 John Ousterhout 提出，作为 RAMCloud 项目中的中心协调组件。Raft 是一种 Leader-Based 的 Multi-Paxos 变种，相比 Paxos、Zab、View Stamped Replication 等协议提供了更完整更清晰的协议描述，并提供了清晰的节点增删描述。 Raft 作为复制状态机，是分布式系统中最核心最基础的组件，提供命令在多个节点之间有序复制和执行，当多个节点初始状态一致的时候，保证节点之间状态一致。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">简而言之Seata的Raft模式就是基于Sofa-Jraft组件实现可保证Seata-Server自身的数据一致性和服务高可用.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-为什么需要raft模式">2.2 为什么需要raft模式<a href="#22-为什么需要raft模式" class="hash-link" aria-label="2.2 为什么需要raft模式的直接链接" title="2.2 为什么需要raft模式的直接链接">​</a></h2><p>看完上述的Seata-Raft模式是什么的定义后,是否就有疑问,难道现在Seata-Server就无法保证一致性和高可用了吗?那么下面从一致性和高可用来看看目前Seata-Server是如何做的.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="221-现有存储模式">2.2.1 现有存储模式<a href="#221-现有存储模式" class="hash-link" aria-label="2.2.1 现有存储模式的直接链接" title="2.2.1 现有存储模式的直接链接">​</a></h3><p>在当前的 Seata 设计中，Server 端的作用是保证事务的二阶段被正确执行。然而，这取决于事务记录的正确存储。为确保事务记录不丢失，需要在保持状态正确的前提下，驱动所有的 Seata-RM 执行正确的二阶段行为。那么，Seata 目前是如何存储事务状态和记录的呢？</p><p>首先介绍一下 Seata 支持的三种事务存储模式：file、db 和 redis。根据一致性的排名，db 模式下的事务记录可以得到最好的保证，其次是 file 模式的异步刷盘，最后是 redis 模式下的 aof 和 rdb</p><p>顾名思义:</p><ul><li>file 模式是 Seata 自实现的事务存储方式，它以顺序写的形式将事务信息存储到本地磁盘上。为了兼顾性能，默认采用异步方式，并将事务信息存储在内存中，确保内存和磁盘上的数据一致性。当 Seata-Server（TC）意外宕机时，在重新启动时会从磁盘读取事务信息并恢复到内存中，以便继续运行事务上下文。</li><li>db 是 Seata 的抽象事务存储管理器（AbstractTransactionStoreManager）的另一种实现方式。它依赖于数据库，如 PostgreSQL、MySQL、Oracle 等，在数据库中进行事务信息的增删改查操作。一致性由数据库的本地事务保证，数据也由数据库负责持久化到磁盘。</li><li>redis 和 db 类似，也是一种事务存储方式。它利用 Jedis 和 Lua 脚本来进行事务的增删改查操作，部分操作（如竞争锁）在 Seata 2.x 版本中全部采用了 Lua 脚本。数据的存储与 db 类似，依赖于存储方（Redis）来保证数据的一致性。与 db 类似，redis 在 Seata 中采用了计算和存储分离的架构设计.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="222-高可用">2.2.2 高可用<a href="#222-高可用" class="hash-link" aria-label="2.2.2 高可用的直接链接" title="2.2.2 高可用的直接链接">​</a></h3><p>高可用简单理解就是集群能够在主节点宕机后继续正常运行，常见的方式是通过部署多个提供相同服务的节点，并通过注册中心实时感知主节点的上下线情况，以便及时切换到可用的节点。</p><p>看起来似乎只需要加几台机器进行部署，但实际上背后存在一个问题，即如何确保多个节点像一个整体一样运作。如果其中一个节点宕机，另一个节点能够完美接替宕机节点的工作，包括处理宕机节点的数据。解决这个问题的答案其实很简单，在计算与存储分离的架构下，只需将数据存储在共享的存储中间件中，任何一个节点都可以通过访问该公共存储区域获取所有节点操作的事务信息，从而实现高可用的能力。</p><p>然而，前提条件是计算与存储必须分离。为什么计算与存储一体化设计不可行呢？这就要说到 File 模式的实现了。如之前描述的，File 模式将数据存储在本地磁盘和节点内存中，数据写操作没有任何同步，这意味着目前的 File 模式无法实现高可用，仅支持单机部署。作为初级的快速入门和简单使用而言，File 模式适用性较低，高性能的基于内存的 File 模式也基本上不再被生产环境使用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="23-seata-raft是如何设计的呢">2.3 Seata-Raft是如何设计的呢？<a href="#23-seata-raft是如何设计的呢" class="hash-link" aria-label="2.3 Seata-Raft是如何设计的呢？的直接链接" title="2.3 Seata-Raft是如何设计的呢？的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="231-设计原理">2.3.1 设计原理<a href="#231-设计原理" class="hash-link" aria-label="2.3.1 设计原理的直接链接" title="2.3.1 设计原理的直接链接">​</a></h3><p>Seata-Raft模式的设计思路是通过封装无法高可用的file模式，利用Raft算法实现多个TC之间数据的同步。该模式保证了使用file模式时多个TC的数据一致性，同时将异步刷盘操作改为使用Raft日志和快照进行数据恢复。
<img loading="lazy" src="https://blog.funkye.icu/img/blog/Dingtalk_20230105203431.jpg" alt="流程图" class="img_ev3q"></p><p>在Seata-Raft模式中，client端在启动时会从配置中心获取当前client的事务分组（例如default）以及相关Raft集群节点的IP地址。通过向Seata-Server的控制端口发送请求，client可以获取到default分组对应的Raft集群的元数据，包括leader、follower和learner成员节点。然后，client会监视（watch）非leader节点的任意成员节点。</p><p>假设TM开始一个事务，并且本地的metadata中的leader节点指向了TC1的地址，那么TM只会与TC1进行交互。当TC1添加一个全局事务信息时，通过Raft协议，即图中标注为步骤1的日志发送，TC1会将日志发送给其他节点，步骤2是follower节点响应日志接收情况。当超过半数的节点（如TC2）接受并响应成功时，TC1上的状态机（FSM）将执行添加全局事务的动作。</p><p><img loading="lazy" src="https://blog.funkye.icu/img/blog/Dingtalk_20230105204423.jpg" alt="watch" class="img_ev3q">
<img loading="lazy" src="https://blog.funkye.icu/img/blog/Dingtalk_20230105211035.jpg" alt="watch2" class="img_ev3q"></p><p>如果TC1宕机或发生重选举，会发生什么呢？由于首次启动时已经获取到了元数据，client会执行watch follower节点的接口来更新本地的metadata信息。因此，后续的事务请求将发送到新的leader（例如TC2）。同时，TC1的数据已经被同步到了TC2和TC3，因此数据一致性不会受到影响。只在选举发生的瞬间，如果某个事务正好发送给了旧的leader，该事务会被主动回滚，以确保数据的正确性。</p><p>需要注意的是，在该模式下，如果事务处于决议发送请求或一阶段流程还未走完的时刻，并且恰好在选举时发生，这些事务会被主动回滚。因为RPC节点已经宕机或发生了重选举，当前没有实现RPC重试。TM侧默认有5次重试机制，但由于选举需要大约1s-2s的时间，这些处于begin状态的事务可能无法成功决议，因此会优先回滚，释放锁，以避免影响其他业务的正确性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="232-故障恢复">2.3.2 故障恢复<a href="#232-故障恢复" class="hash-link" aria-label="2.3.2 故障恢复的直接链接" title="2.3.2 故障恢复的直接链接">​</a></h3><p>在Seata中，当TC发生故障时，数据恢复的过程如下：</p><p><img loading="lazy" src="https://blog.funkye.icu/img/blog/Dingtalk_20230106231817.jpg" alt="故障恢复" class="img_ev3q"></p><p>如上图所示</p><ul><li><p>检查是否存在最新的数据快照：首先，系统会检查是否存在最新的数据快照文件。数据快照是基于内存的数据状态的一次全量拷贝，如果有最新的数据快照，则系统将直接加载该快照到内存中。</p></li><li><p>根据快照后的Raft日志进行回放：如果存在最新的快照或者没有快照文件，系统将根据之前记录的Raft日志进行数据回放。每个Seata-Server中的请求最终会经过ServerOnRequestProcessor进行处理，然后转移到具体的协调者类(DefaultCoordinator或RaftCoordinator)中，再转向具体的业务代码(DefaultCore)进行相应的事务处理（如begin、commit、rollback等）。</p></li><li><p>当日志回放完成后，便会由leader发起日志的同步，并继续执行相关事务的增删改动作。</p></li></ul><p>通过以上步骤，Seata能够实现在故障发生后的数据恢复。首先尝试加载最新的快照，如果有的话可以减少回放的时间；然后根据Raft日志进行回放，保证数据操作的一致性；最后通过日志同步机制，确保数据在多节点之间的一致性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="233-业务处理同步过程">2.3.3 业务处理同步过程<a href="#233-业务处理同步过程" class="hash-link" aria-label="2.3.3 业务处理同步过程的直接链接" title="2.3.3 业务处理同步过程的直接链接">​</a></h3><p><img loading="lazy" src="https://blog.funkye.icu/img/blog/Dingtalk_20230106230931.jpg" alt="流程" class="img_ev3q">
对于client侧获取最新metadata时恰好有业务线程在执行begin、commit或registry等操作的情况，Seata采取了以下处理方式：</p><ul><li><p>client侧：</p><ul><li>如果客户端正在执行begin、commit或registry等操作，并且此时需要获取最新metadata，由于此时的leader可能已经不存在或不是当前leader，因此客户端的RPC请求可能会失败。</li><li>如果请求失败，客户端会收到异常响应，此时客户端需要根据请求的结果进行回滚操作。</li></ul></li><li><p>TC侧对旧leader的检测：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- 在TC侧，如果此时客户端的请求到达旧的leader节点，TC会进行当前是否是leader的检测，如果不是leader，则会拒绝该请求。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 如果是leader但在中途失败，比如在提交任务到状态机的过程中失败，由于当前已经不是leader，创建任务（createTask）的动作会失败。这样，客户端也会接收到响应异常。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 旧leader的提交任务也会失败，确保了事务信息的一致性。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过上述处理方式，当客户端获取最新metadata时恰好遇到业务操作的情况，Seata能够保证数据的一致性和事务的正确性。如果客户端的RPC请求失败，将触发回滚操作；而在TC侧，对旧leader的检测和任务提交的失败可以防止事务信息不一致的问题。这样，客户端的数据也能保持一致性。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3使用部署">3.使用部署<a href="#3使用部署" class="hash-link" aria-label="3.使用部署的直接链接" title="3.使用部署的直接链接">​</a></h2><p>在使用和部署上，社区秉持着最小侵入，最小改动的原则，所以整体的部署上手应该是非常简单的，接下来分开client与server两端的部署改动点进行介绍</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-client">3.1 client<a href="#31-client" class="hash-link" aria-label="3.1 client的直接链接" title="3.1 client的直接链接">​</a></h3><p>首先，使用注册配置中心较多的同学应该知道Seata的配置项中有一个<code>seata.registry.type</code>的配置项，支持了nacos，zk，etcd，redis等等，而在2.0以后增加了一个raft的配置项</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   registry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type: raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      raft:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         server-addr: 192.168.0.111:7091, 192.168.0.112:7091, 192.168.0.113:7091</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将<code>registry.type</code> 改为raft，并配置raft相关元数据的获取地址，该地址统一为seata-server的ip+http端口
然后必不可少的就是传统的事务分组的配置</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">seata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   tx-service-group: default_tx_group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      vgroup-mapping:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         default_tx_group: default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如现在使用的事务分组为<code>default_tx_group</code>，那么对应的seata集群/分组就是default，这个是有对应关系的，后续再server部署环节上会介绍
至此client的改动已经完成了</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-server">3.2 server<a href="#32-server" class="hash-link" aria-label="3.2 server的直接链接" title="3.2 server的直接链接">​</a></h3><p>对于server的改动可能会多一些，要熟悉一些调优参数和配置，当然也可以选择默认值不做任何修改</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">seata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    raft:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group: default #此值代表该raft集群的group，client的事务分组对应的值要与之对应</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      server-addr: 192.168.0.111:9091,192.168.0.112:9091,192.168.0.113:9091 # 3台节点的ip和端口，端口为该节点的netty端口+1000，默认netty端口为8091</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      snapshot-interval: 600 # 600秒做一次数据的快照，以便raftlog的快速滚动，但是每次做快照如果内存中事务数据过多会导致每600秒产生一次业务rt的抖动，但是对于故障恢复比较友好，重启节点较快，可以调整为30分钟，1小时都行，具体按业务来，可以自行压测看看是否有抖动，在rt抖动和故障恢复中自行找个平衡点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      apply-batch: 32 # 最多批量32次动作做一次提交raftlog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max-append-bufferSize: 262144 #日志存储缓冲区最大大小，默认256K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max-replicator-inflight-msgs: 256 #在启用 pipeline 请求情况下，最大 in-flight 请求数，默认256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disruptor-buffer-size: 16384 #内部 disruptor buffer 大小，如果是写入吞吐量较高场景，需要适当调高该值，默认 16384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      election-timeout-ms: 1000 #超过多久没有leader的心跳开始重选举</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reporter-enabled: false # raft自身的监控是否开启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reporter-initial-delay: 60 # 监控的区间间隔</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serialization: jackson # 序列化方式，不要改动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      compressor: none # raftlog的压缩方式，如gzip，zstd等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sync: true # raft日志的刷盘方式，默认是同步刷盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # support: nacos, consul, apollo, zk, etcd3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: file # 该配置可以选择不同的配置中心</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # support: nacos, eureka, redis, zk, consul, etcd3, sofa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: file # raft模式下不允许使用非file的其他注册中心</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  store:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # support: file 、 db 、 redis 、 raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode: raft # 使用raft存储模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dir: sessionStore # 该路径为raftlog及事务相关日志的存储位置，默认是相对路径，最好设置一个固定的位置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在3个或者大于3个节点的seata-server中配置完以上参数后，直接启动便可以看到类似以下的日志输出,就代表集群已经正常启动了</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.392  WARN --- [Rpc-netty-server-worker-10-thread-1] [com.alipay.sofa.jraft.rpc.impl.BoltRaftRpcFactory] [ensurePipeline] []: JRaft SET bolt.rpc.dispatch-msg-list-in-default-executor to be false for replicator pipeline optimistic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.439  INFO --- [default/PeerPair[10.58.16.231:9091 -&gt; 10.58.12.217:9091]-AppendEntriesThread0] [com.alipay.sofa.jraft.storage.impl.LocalRaftMetaStorage] [save] []: Save raft meta, path=sessionStore/raft/9091/default/raft_meta, term=4, votedFor=0.0.0.0:0, cost time=25 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.441  WARN --- [default/PeerPair[10.58.16.231:9091 -&gt; 10.58.12.217:9091]-AppendEntriesThread0] [com.alipay.sofa.jraft.core.NodeImpl] [handleAppendEntriesRequest] []: Node &lt;default/10.58.16.231:9091&gt; reject term_unmatched AppendEntriesRequest from 10.58.12.217:9091, term=4, prevLogIndex=4, prevLogTerm=4, localPrevLogTerm=0, lastLogIndex=0, entriesSize=0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.442  INFO --- [JRaft-FSMCaller-Disruptor-0] [io.seata.server.cluster.raft.RaftStateMachine] [onStartFollowing] []: groupId: default, onStartFollowing: LeaderChangeContext [leaderId=10.58.12.217:9091, term=4, status=Status[ENEWLEADER&lt;10011&gt;: Raft node receives message from new leader with higher term.]].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.449  WARN --- [default/PeerPair[10.58.16.231:9091 -&gt; 10.58.12.217:9091]-AppendEntriesThread0] [com.alipay.sofa.jraft.core.NodeImpl] [handleAppendEntriesRequest] []: Node &lt;default/10.58.16.231:9091&gt; reject term_unmatched AppendEntriesRequest from 10.58.12.217:9091, term=4, prevLogIndex=4, prevLogTerm=4, localPrevLogTerm=0, lastLogIndex=0, entriesSize=0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.459  INFO --- [Bolt-default-executor-4-thread-1] [com.alipay.sofa.jraft.core.NodeImpl] [handleInstallSnapshot] []: Node &lt;default/10.58.16.231:9091&gt; received InstallSnapshotRequest from 10.58.12.217:9091, lastIncludedLogIndex=4, lastIncludedLogTerm=4, lastLogId=LogId [index=0, term=0].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.489  INFO --- [Bolt-conn-event-executor-13-thread-1] [com.alipay.sofa.jraft.rpc.impl.core.ClientServiceConnectionEventProcessor] [onEvent] []: Peer 10.58.12.217:9091 is connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.519  INFO --- [JRaft-Group-Default-Executor-0] [com.alipay.sofa.jraft.util.Recyclers] [&lt;clinit&gt;] []: -Djraft.recyclers.maxCapacityPerThread: 4096.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.574  INFO --- [JRaft-Group-Default-Executor-0] [com.alipay.sofa.jraft.storage.snapshot.local.LocalSnapshotStorage] [destroySnapshot] []: Deleting snapshot sessionStore/raft/9091/default/snapshot/snapshot_4.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.574  INFO --- [JRaft-Group-Default-Executor-0] [com.alipay.sofa.jraft.storage.snapshot.local.LocalSnapshotStorage] [close] []: Renaming sessionStore/raft/9091/default/snapshot/temp to sessionStore/raft/9091/default/snapshot/snapshot_4.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.689  INFO --- [JRaft-FSMCaller-Disruptor-0] [io.seata.server.cluster.raft.snapshot.session.SessionSnapshotFile] [load] []: on snapshot load start index: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.694  INFO --- [JRaft-FSMCaller-Disruptor-0] [io.seata.server.cluster.raft.snapshot.session.SessionSnapshotFile] [load] []: on snapshot load end index: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.694  INFO --- [JRaft-FSMCaller-Disruptor-0] [io.seata.server.cluster.raft.RaftStateMachine] [onSnapshotLoad] []: groupId: default, onSnapshotLoad cost: 110 ms.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.694  INFO --- [JRaft-FSMCaller-Disruptor-0] [io.seata.server.cluster.raft.RaftStateMachine] [onConfigurationCommitted] []: groupId: default, onConfigurationCommitted: 10.58.12.165:9091,10.58.12.217:9091,10.58.16.231:9091.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.705  INFO --- [JRaft-FSMCaller-Disruptor-0] [com.alipay.sofa.jraft.storage.snapshot.SnapshotExecutorImpl] [onSnapshotLoadDone] []: Node &lt;default/10.58.16.231:9091&gt; onSnapshotLoadDone, last_included_index: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">last_included_term: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">peers: &quot;10.58.12.165:9091&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">peers: &quot;10.58.12.217:9091&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">peers: &quot;10.58.16.231:9091&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-10-13 17:20:06.722  INFO --- [JRaft-Group-Default-Executor-1] [com.alipay.sofa.jraft.storage.impl.RocksDBLogStorage] [lambda$truncatePrefixInBackground$2] []: Truncated prefix logs in data path: sessionStore/raft/9091/default/log from log index 1 to 5, cost 0 ms.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-faq">3.3 faq<a href="#33-faq" class="hash-link" aria-label="3.3 faq的直接链接" title="3.3 faq的直接链接">​</a></h3><ul><li>当<code>seata.raft.server-addr</code>配置好后，必须通过server的openapi进行集群的扩缩容，直接改动该配置进行重启是不会生效的
接口为<code>/metadata/v1/changeCluster?raftClusterStr=新的集群列表</code> </li><li>如果<code>server-addr:</code>中的地址都为本机，那么需要根据本机上不同的server的netty端口增加1000的偏移量，如<code>server.port: 7092</code>那么netty端口为8092，raft选举和通信端口便为9092，需要增加启动参数<code>-Dserver.raftPort=9092</code>.
Linux下可以通过<code>export JAVA_OPT=&quot;-Dserver.raftPort=9092&quot;</code>等方式指定。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4压测对比">4.压测对比<a href="#4压测对比" class="hash-link" aria-label="4.压测对比的直接链接" title="4.压测对比的直接链接">​</a></h2><p>压测对比分为两种场景,并且为了避免数据热点冲突与线程调优等情况,将Client侧的数据初始化300W条商品,并直接使用jdk21虚拟线程+spring boot3+seata AT来测试,在gc方面全部采用分代ZGC进行,压测工具为阿里云PTS，Server侧统一使用jdk21(目前还未适配虚拟线程) 服务器配置如下
TC: 4c8g<em>3  Client: 4c</em>8G*1  数据库为阿里云rds 4c16g</p><ul><li>64并发压测只增加<code>@Globaltransactional</code>注解接口空提交的性能</li><li>随机300W数据进行32并发10分钟的扣库存</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-171-db模式">4.1 1.7.1 db模式<a href="#41-171-db模式" class="hash-link" aria-label="4.1 1.7.1 db模式的直接链接" title="4.1 1.7.1 db模式的直接链接">​</a></h3><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i3/O1CN011dNh3H1UK8G5prQAg_!!6000000002498-0-tps-731-333.jpg" alt="raft压测模型" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="空提交-64c">空提交 64C<a href="#空提交-64c" class="hash-link" aria-label="空提交 64C的直接链接" title="空提交 64C的直接链接">​</a></h4><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i2/O1CN01pE1Anf1nRtgcnlx9t_!!6000000005087-0-tps-622-852.jpg" alt="db64-2" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="随机扣库存-32c">随机扣库存 32C<a href="#随机扣库存-32c" class="hash-link" aria-label="随机扣库存 32C的直接链接" title="随机扣库存 32C的直接链接">​</a></h4><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i2/O1CN016hZkJC20OJax9ce31_!!6000000006839-0-tps-624-852.jpg" alt="db32-2" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-20-raft模式">4.2 2.0 raft模式<a href="#42-20-raft模式" class="hash-link" aria-label="4.2 2.0 raft模式的直接链接" title="4.2 2.0 raft模式的直接链接">​</a></h3><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i2/O1CN01nNL6oe1X95YcQQEjs_!!6000000002880-0-tps-773-353.jpg" alt="raft压测模型" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="空提交-64c-1">空提交 64C<a href="#空提交-64c-1" class="hash-link" aria-label="空提交 64C的直接链接" title="空提交 64C的直接链接">​</a></h4><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i1/O1CN01rs1ykr1dhnH8qnXj3_!!6000000003768-0-tps-631-851.jpg" alt="raft64-2" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="随机扣库存-32c-1">随机扣库存 32C<a href="#随机扣库存-32c-1" class="hash-link" aria-label="随机扣库存 32C的直接链接" title="随机扣库存 32C的直接链接">​</a></h4><p><img loading="lazy" src="https://img.alicdn.com/imgextra/i4/O1CN015OwA2k20enquV7Yfu_!!6000000006875-0-tps-624-856.jpg" alt="raft32c-2" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-压测结果对比">4.3 压测结果对比<a href="#43-压测结果对比" class="hash-link" aria-label="4.3 压测结果对比的直接链接" title="4.3 压测结果对比的直接链接">​</a></h3><p>32并发对300W商品随机扣库存场景</p><table><thead><tr><th>tps avg</th><th>tps max</th><th>count</th><th>rt</th><th>error</th><th>存储类型</th></tr></thead><tbody><tr><td>1709(42%↑)</td><td>2019(21%↑)</td><td>1228803(42%↑)</td><td>13.86ms(30%↓)</td><td>0</td><td>Raft</td></tr><tr><td>1201</td><td>1668</td><td>864105</td><td>19.86ms</td><td>0</td><td>DB</td></tr></tbody></table><p>64并发空压<code>@Globaltransactional</code>接口（压测峰值上限为8000）</p><table><thead><tr><th>tps avg</th><th>tps max</th><th>count</th><th>rt</th><th>error</th><th>存储类型</th></tr></thead><tbody><tr><td>5704(20%↑)</td><td>8062(30%↑)</td><td>4101236(20%↑)</td><td>7.79ms(19%↓)</td><td>0</td><td>Raft</td></tr><tr><td>4743</td><td>6172</td><td>3410240</td><td>9.65ms</td><td>0</td><td>DB</td></tr></tbody></table><p>除了以上数据上的直观对比,通过对压测的曲线图来观察,raft模式下tps与rt更加平稳,抖动更少,性能与吞吐量上更佳.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5总结">5.总结<a href="#5总结" class="hash-link" aria-label="5.总结的直接链接" title="5.总结的直接链接">​</a></h2><p>在Seata未来的发展中，性能、入门门槛、部署运维成本，都是我们需要关注和不断优化的方向，在raft模式推出后有以下几个特点:</p><ol><li>如存储方面，存算分离后Seata对其优化的上限被拔高，自主可控</li><li>部署成本更低，无需额外的注册中心，存储中间件</li><li>入门的门槛更低，无需学习其他的一些如注册中心的知识，一站式直接使用Seata Raft 即可上手</li></ol><p>针对业界发展趋势，一些开源项目如ClickHouse和Kafka已经开始放弃使用ZooKeeper，并转而采用自研的解决方案，比如ClickKeeper和KRaft。这些方案将元数据等信息交由自身保证存储，以减少对第三方依赖的需求，从而降低运维成本和学习成本。这些特性是非常成熟和可借鉴的。</p><p>当然，目前来看，基于Raft模式的解决方案可能还不够成熟，可能无法完全达到上述描述的那样美好。然而，正是因为存在这样的理论基础，社区更应该朝着这个方向努力，让实践逐步接近理论的要求。在这里，欢迎所有对Seata感兴趣的同学加入社区，共同为Seata添砖加瓦！</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-connect-data-and-application">Seata：连接数据与应用</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-30T00:00:00.000Z" itemprop="datePublished">2023年6月30日</time> · <!-- -->阅读需 23 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">季敏-Seata 开源社区创始人，分布式事务团队负责人</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>本文主要介绍分布式事务从内部到商业化和开源的演进历程，Seata社区当前进展和未来规划。</p><p>Seata是一款开源的分布式事务解决方案，旨在为现代化微服务架构下的分布式事务提供解决方案。Seata提供了完整的分布式事务解决方案，包括AT、TCC、Saga和XA事务模式，可支持多种编程语言和数据存储方案。Seata还提供了简便易用的API，以及丰富的文档和示例，方便企业在应用Seata时进行快速开发和部署。</p><p><strong>Seata的优势在于具有高可用性、高性能、高扩展性等特点，同时在进行横向扩展时也无需做额外的复杂操作。</strong> 目前Seata已在阿里云上几千家客户业务系统中使用，其可靠性得到了业内各大厂商的认可和应用。</p><p>作为一个开源项目，Seata的社区也在不断扩大，现已成为开发者交流、分享和学习的重要平台，也得到了越来越多企业的支持和关注。</p><p>今天我主要针对以下三个小议题对Seata进行分享：</p><ul><li><strong>从TXC/GTS 到 Seata</strong></li><li><strong>Seata 社区最新进展</strong></li><li><strong>Seata 社区未来规划</strong><br></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="从txcgts-到seata">从TXC/GTS 到Seata<a href="#从txcgts-到seata" class="hash-link" aria-label="从TXC/GTS 到Seata的直接链接" title="从TXC/GTS 到Seata的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="分布式事务的缘起">分布式事务的缘起<a href="#分布式事务的缘起" class="hash-link" aria-label="分布式事务的缘起的直接链接" title="分布式事务的缘起的直接链接">​</a></h4><p><img loading="lazy" alt="产品矩阵" src="/zh-cn/assets/images/产品矩阵-911645846cd62c27fb3e2aaef802b52e.jpg" width="1468" height="1316" class="img_ev3q">
Seata 在阿里内部的产品代号叫TXC（taobao transaction constructor），这个名字有非常浓厚的组织架构色彩。TXC 起源于阿里五彩石项目，五彩石是上古神话中女娲补天所用的石子，项目名喻意为打破关键技术壁垒，象征着阿里在从单体架构向分布式架构的演进过程中的重要里程碑。在这个项目的过程中演进出一批划时代的互联网中间件，包括我们常说的三大件：</p><ul><li><strong>HSF 服务调用框架</strong><br>解决单体应用到服务化后的服务通信调用问题。</li><li><strong>TDDL 分库分表框架</strong><br>解决规模化后单库存储容量和连接数问题。</li><li><strong>MetaQ 消息框架</strong><br>解决异步调用问题。</li></ul><p>三大件的诞生满足了微服务化业务开发的基本需求，但是微服务化后的数据一致性问题并未得到妥善解决，缺少统一的解决方案。应用微服务化后出现数据一致性问题概率远大于单体应用，从进程内调用到网络调用这种复杂的环境加剧了异常场景的产生，服务跳数的增多使得在出现业务处理异常时无法协同上下游服务同时进行数据回滚。TXC的诞生正是为了解决应用架构层数据一致性的痛点问题，TXC 核心要解决的数据一致性场景包括：</p><ul><li><strong>跨服务的一致性。</strong> 应对系统异常如调用超时和业务异常时协调上下游服务节点回滚。</li><li><strong>分库分表的数据一致性。</strong> 应对业务层逻辑SQL操作的数据在不同数据分片上，保证其分库分表操作的内部事务。</li><li><strong>消息发送的数据一致性。</strong> 应对数据操作和消息发送成功的不一致性问题。</li></ul><p>为了克服以上通用场景遇到的问题，TXC与三大件做了无缝集成。业务使用三大件开发时，完全感知不到背后TXC的存在，业务不需要考虑数据一致性的设计问题，数据一致性保证交给了框架托管，业务更加聚焦于业务本身的开发，极大的提升了开发的效率。</p><br><p><img loading="lazy" alt="GTS架构" src="/zh-cn/assets/images/GTS架构-f19f670582426aaac8da0f69c1d7ae35.jpg" width="1482" height="1294" class="img_ev3q"> </p><p>TXC已在阿里集团内部广泛应用多年，经过双11等大型活动的洪荒流量洗礼，TXC极大提高了业务的开发效率，保证了数据的正确性，消除了数据不一致导致的资损和商誉问题。随着架构的不断演进，<strong>标准的三节点集群已可以承载接近10W TPS的峰值和毫秒级事务处理。在可用性和性能方面都达到了4个9的SLA保证，即使在无值守状态下也能保证全年无故障。</strong></p><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="分布式事务的演进">分布式事务的演进<a href="#分布式事务的演进" class="hash-link" aria-label="分布式事务的演进的直接链接" title="分布式事务的演进的直接链接">​</a></h4><p>新事物的诞生总是会伴随着质疑的声音。中间件层来保证数据一致性到底可靠吗？TXC最初的诞生只是一种模糊的理论，缺乏理论模型和工程实践。在我们进行MVP（最小可行产品）模型测试并推广业务上线后，经常出现故障，常常需要在深夜起床处理问题，睡觉时要佩戴手环来应对紧急响应，这也是我接管这个团队在技术上过的最痛苦的几年。</p><p><img loading="lazy" alt="分布式事务演进" src="/zh-cn/assets/images/分布式事务演进-cd118286fd5a0add7ecf5775e381a1f5.jpg" width="1488" height="702" class="img_ev3q">  </p><p>随后，我们进行了广泛的讨论和系统梳理。我们首先需要定义一致性问题，我们是要像RAFT一样实现多数共识一致性，还是要像Google Spanner一样解决数据库一致性问题，还是其他方式？从应用节点自上而下的分层结构来看，主要包括开发框架、服务调用框架、数据中间件、数据库Driver和数据库。我们需要决定在哪一层解决数据一致性问题。我们比较了解决不同层次数据一致性问题所面临的一致性要求、通用性、实现复杂度和业务接入成本。最后，我们权衡利弊，把实现复杂度留给我们，作为一个一致性组件，我们需要确保较高的一致性，但又不能锁定到具体数据库的实现上，确保场景的通用性和业务接入成本足够低以便更容易实现业务，这也是TXC最初采用AT模式的原因。</p><p><strong>分布式事务它不仅仅是一个框架，它是一个体系。</strong>  我们在理论上定义了一致性问题，概念上抽象出了模式、角色、动作和隔离性等。从工程实践的角度，我们定义了编程模型，包括低侵入的注解、简单的方法模板和灵活的API ，定义了事务的基础能力和增强能力（例如如何以低成本支持大量活动），以及运维、安全、性能、可观测性和高可用等方面的能力。</p><p><img loading="lazy" alt="事务逻辑模型" src="/zh-cn/assets/images/事务逻辑模型-bd13bfb9738e5aca63823d268e543280.jpg" width="1482" height="656" class="img_ev3q">
分布式事务解决了哪些问题呢？一个经典且具有体感的例子就是转账场景。转账过程包括减去余额和增加余额两个步骤，我们如何保证操作的原子性？在没有任何干预的情况下，这两个步骤可能会遇到各种问题，例如B账户已销户或出现服务调用超时等情况。</p><p><strong>超时问题一直是分布式应用中比较难解决的问题</strong>，我们无法准确知晓B服务是否执行以及其执行顺序。从数据的角度来看，这意味着B 账户的钱未必会被成功加起来。在服务化改造之后，每个节点仅获知部分信息，而事务本身需要全局协调所有节点，因此需要一个拥有上帝视角、能够获取全部信息的中心化角色，这个角色就是<strong>TC（transaction coordinator）</strong>，它用于全局协调事务的状态。<strong>TM（Transaction Manager）</strong> 则是驱动事务生成提议的角色。但是，即使上帝也有打瞌睡的时候，他的判断也并不总是正确的，因此需要一个<strong>RM（resource manager）</strong> 角色作为灵魂的代表来验证事务的真实性。这就是TXC 最基本的哲学模型。我们从方法论上验证了它的数据一致性是非常完备的，当然，我们的认知是有边界的。也许未来会证明我们是火鸡工程师，但在当前情况下，它的模型已经足以解决大部分现有问题。</p><p><img loading="lazy" alt="分布式事务性能" src="/zh-cn/assets/images/分布式事务性能-379ce638304757417a8ed74fe07fc69c.jpg" width="1494" height="674" class="img_ev3q">
<strong>经过多年的架构演进，从事务的单链路耗时角度来看，TXC在事务开始时的处理平均时间约为0.2毫秒，分支注册的平均时间约为0.4毫秒，整个事务额外的耗时在毫秒级别之内。这也是我们推算出的极限理论值。在吞吐量方面，单节点的TPS达到3万次/秒，标准集群的TPS接近10万次/秒。</strong></p><br>#### Seata 开源 为什么要做开源？这是很多人问过我的问题。2017年我们做了商业化的 GTS（Global Transaction Service ）产品产品在阿里云上售卖，有公有云和专有云两种形态。此时集团内发展的顺利，但是在我们商业化的过程中并不顺利，我们遇到了各种各样的问题，问题总结起来主要包括两类：**一是开发者对于分布式事务的理论相当匮乏，** 大多数人连本地事务都没搞明白是怎么回事更何况是分布式事务。 **二是产品成熟度上存在问题，** 经常遇到稀奇古怪的场景问题，导致了支持交付成本的急剧上升，研发变成了售后客服。<p>我们反思为什么遇到如此多的问题，这里主要的问题是在阿里集团内部是统一语言栈和统一技术栈的，我们对特定场景的打磨是非常成熟的，服务阿里一家公司和服务云上成千上万家企业有本质的区，这也启示我们产品的场景生态做的不够好。在GitHub 80%以上的开源软件是基础软件，基础软件首要解决的是场景通用性问题，因此它不能被有一家企业Lock In，比如像Linux，它有非常多的社区分发版本。因此，为了让我们的产品变得更好，我们选择了开源，与开发者们共建，普及更多的企业用户。</p><p><img loading="lazy" alt="阿里开源" src="/zh-cn/assets/images/阿里开源-b55a3c66abd52e6502162a991c8e92c3.jpg" width="1484" height="696" class="img_ev3q">
阿里的开源经历了三个主要阶段。<strong>第一个阶段是Dubbo所处的阶段，开发者用爱发电，</strong> Dubbo开源了有10几年的时间，时间充分证明了Dubbo是非常优秀的开源软件，它的微内核插件化的扩展性设计也是我最初开源Seata 的重要参考。做软件设计的时候我们要思考扩展性和性能权衡起来哪个会更重要一些，我们到底是要做一个三年的设计，五年的设计亦或是满足业务发展的十年设计。我们在做0-1服务调用问题的解决方案的同时，能否预测到1-100规模化后的治理问题。</p><p><strong>第二个阶段是开源和商业化的闭环，商业化反哺于开源社区，促进了开源社区的发展。</strong> 我认为云厂商更容易做好开源的原因如下：</p><ul><li>首先，云是一个规模化的经济，必然要建立在稳定成熟的内核基础上，在上面去包装其产品化能力包括高可用、免运维和弹性能力。不稳定的内核必然导致过高的交付支持成本，研发团队的支持答疑穿透过高，过高的交付成本无法实现大规模的复制，穿透率过高无法使产品快速的演进迭代。</li><li>其次，商业产品是更懂业务需求的。我们内部团队做技术的经常是站在研发的视角YY 需求，做出来的东西没有人使用，也就不会形成价值的转换。商业化收集到的都是真实的业务需求，因此，它的开源内核也必须会朝着这个方向演进。如果不朝着这个方向去演进必然导致两边架构上的分裂，增加团队的维护成本。</li><li>最后，开源和商业化闭环，能促进双方更好的发展。如果开源内核经常出现各种问题，你是否愿意相信的它的商业化产品是足够优秀的。</li></ul><p><strong>第三个阶段是体系化和标准化。</strong> 首先，体系化是开源解决方案的基础。阿里的开源项目大多是基于内部电商场景的实践而诞生的。例如Higress，它用于打通蚂蚁集团的网关；Nacos承载着服务的百万实例和千万连接；Sentinel 提供大促时的降级和限流等高可用性能力；而Seata负责保障交易数据的一致性。这套体系化的开源解决方案是基于阿里电商生态的最佳实践而设计的。其次，标准化是另一个重要的特点。以OpenSergo为例，它既是一个标准，又是一个实现。在过去几年里，国内开源项目数量呈爆发式增长。然而，各个开源产品的能力差异很大，彼此集成时会遇到许多兼容性问题。因此，像OpenSergo这样的开源项目能够定义一些标准化的能力和接口，并提供一些实现，这将为整个开源生态系统的发展提供极大的帮助。</p><br><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-社区最新进展">Seata 社区最新进展<a href="#seata-社区最新进展" class="hash-link" aria-label="Seata 社区最新进展的直接链接" title="Seata 社区最新进展的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata-社区简介">Seata 社区简介<a href="#seata-社区简介" class="hash-link" aria-label="Seata 社区简介的直接链接" title="Seata 社区简介的直接链接">​</a></h4><p><img loading="lazy" alt="社区简介" src="/zh-cn/assets/images/社区简介-f911410600da0ddea225d92d7a0e3e96.jpg" width="1484" height="686" class="img_ev3q">
<strong>目前，Seata已经开源了4种事务模式，包括AT、TCC、Saga和XA，并在积极探索其他可行的事务解决方案。</strong> Seata已经与10多个主流的RPC框架和关系数据库进行了集成，同时与20 多个社区存在集成和被集成的关系。此外，我们还在多语言体系上探索除Java之外的语言，如Golang、PHP、Python和JS。</p><p>Seata已经被几千家客户应用到业务系统中。Seata的应用已经变得越来越成熟，在金融业务场景中信银行和光大银行与社区做了很好的合作，并成功将其纳入到核心账务系统中。在金融场景对微服务体系的落地是非常严苛的，这也标志着Seata的内核成熟度迈上了一个新台阶。</p><br>#### Seata 扩展生态 ![扩展生态](/img/blog/扩展生态.jpg) **Seata采用了微内核和插件化的设计，它在API、注册配置中心、存储模式、锁控制、SQL解析器、负载均衡、传输、协议编解码、可观察性等方面暴露了丰富的扩展点。** 这使得业务可以方便地进行灵活的扩展和技术组件的选择。<br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata-应用案例">Seata 应用案例<a href="#seata-应用案例" class="hash-link" aria-label="Seata 应用案例的直接链接" title="Seata 应用案例的直接链接">​</a></h4><p><img loading="lazy" alt="应用案例" src="/zh-cn/assets/images/应用案例-be6fb71d8ac5031679b2b52a9f158f61.jpg" width="1268" height="1286" class="img_ev3q">
<strong>案例1：中航信航旅纵横项目</strong><br>
<!-- -->中航信航旅纵横项目在Seata 0.2版本中引入Seata解决机票和优惠券业务的数据一致性问题，大大提高了开发效率、减少了数据不一致造成的资损并提升了用户交互体验。</p><p><strong>案例2：滴滴出行二轮车事业部</strong><br>
<!-- -->滴滴出行二轮车事业部在Seata 0.6.1版本中引入Seata，解决了小蓝单车、电动车、资产等业务流程的数据一致性问题，优化了用户使用体验并减少了资产的损失。</p><p><strong>案例3：美团基础架构</strong><br>
<!-- -->美团基础架构团队基于开源的Seata项目开发了内部分布式事务解决方案Swan，被用于解决美团内部各业务的分布式事务问题。</p><p><strong>场景4：盒马小镇</strong><br>
<!-- -->盒马小镇在游戏互动中使用Seata控制偷花的流程，开发周期大大缩短，从20天缩短到了5天，有效降低了开发成本。</p><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata-事务模式的演进">Seata 事务模式的演进<a href="#seata-事务模式的演进" class="hash-link" aria-label="Seata 事务模式的演进的直接链接" title="Seata 事务模式的演进的直接链接">​</a></h4><p><img loading="lazy" alt="模式演进" src="/zh-cn/assets/images/模式演进-ec00bf742388aa93e4aa2624f5d6fbc1.jpg" width="1492" height="574" class="img_ev3q"></p><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata-当前进展">Seata 当前进展<a href="#seata-当前进展" class="hash-link" aria-label="Seata 当前进展的直接链接" title="Seata 当前进展的直接链接">​</a></h4><ul><li>支持 Oracle和 Postgresql 多主键。</li><li>支持 Dubbo3</li><li>支持 Spring Boot3</li><li>支持 JDK 17</li><li>支持 ARM64 镜像</li><li>支持多注册模型</li><li>扩展了多种SQL语法</li><li>支持 GraalVM Native Image</li><li>支持 Redis lua 存储模式<br></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-2x-发展规划">Seata 2.x 发展规划<a href="#seata-2x-发展规划" class="hash-link" aria-label="Seata 2.x 发展规划的直接链接" title="Seata 2.x 发展规划的直接链接">​</a></h3><p><img loading="lazy" alt="发展规划" src="/zh-cn/assets/images/发展规划-9b7132eb93fdaaa430a832be0142cebc.jpg" width="1476" height="678" class="img_ev3q"> </p><p>主要包括下面几个方面：</p><ul><li><strong>存储/协议/特性</strong><br>存储模式上探索存算不分离的Raft集群模式；更好的体验，统一当前4种事务模式的API；兼容GTS协议；支持Saga注解；支持分布式锁的控制；支持以数据视角的洞察和治理。</li><li><strong>生态</strong><br>融合支持更多的数据库，更多的服务框架，同时探索国产化信创生态的支持；支持MQ生态；进一步完善APM的支持。</li><li><strong>解决方案</strong><br>解决方案上除了支持微服务生态探索多云方案；更贴近云原生的解决方案；增加安全和流量防护能力；实现架构上核心组件的自闭环收敛。</li><li><strong>多语言生态</strong><br>多语言生态中Java最成熟，其他已支持的编程语言继续完善，同时探索与语言无关的Transaction Mesh方案。</li><li><strong>研发效能/体验</strong><br>提升测试的覆盖率，优先保证质量、兼容性和稳定性；重构官网文档结构，提升文档搜索的命中率；在体验上简化运维部署，实现一键安装和配置元数据简化；控制台支持事务控制和在线分析能力。
</li></ul><p>一句话总结2.x 的规划：<strong>更大的场景，更大的生态，从可用到好用。</strong></p><br><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-社区联系方式">Seata 社区联系方式<a href="#seata-社区联系方式" class="hash-link" aria-label="Seata 社区联系方式的直接链接" title="Seata 社区联系方式的直接链接">​</a></h3><p><img loading="lazy" alt="联系方式" src="/zh-cn/assets/images/联系方式-9883f643b19238bb617036df09d2731f.jpg" width="1158" height="356" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-observable-practice">Seata的可观测实践</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-25T00:00:00.000Z" itemprop="datePublished">2023年6月25日</time> · <!-- -->阅读需 12 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">刘戎-Seata</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata简介">Seata简介<a href="#seata简介" class="hash-link" aria-label="Seata简介的直接链接" title="Seata简介的直接链接">​</a></h2><p>Seata的前身是阿里巴巴集团内大规模使用保证分布式事务一致性的中间件，Seata是其开源产品，由社区维护。在介绍Seata前，先与大家讨论下我们业务发展过程中经常遇到的一些问题场景。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="业务场景">业务场景<a href="#业务场景" class="hash-link" aria-label="业务场景的直接链接" title="业务场景的直接链接">​</a></h3><p>我们业务在发展的过程中，基本上都是从一个简单的应用，逐渐过渡到规模庞大、业务复杂的应用。这些复杂的场景难免遇到分布式事务管理问题，Seata的出现正是解决这些分布式场景下的事务管理问题。介绍下其中几个经典的场景：</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景一分库分表场景下的分布式事务">场景一：分库分表场景下的分布式事务<a href="#场景一分库分表场景下的分布式事务" class="hash-link" aria-label="场景一：分库分表场景下的分布式事务的直接链接" title="场景一：分库分表场景下的分布式事务的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-分库分表场景下的分布式事务-ee0eff8cf24e6e3e997b0b040c56690e.png" width="1200" height="624" class="img_ev3q">
起初我们的业务规模小、轻量化，单一数据库就能保障我们的数据链路。但随着业务规模不断扩大、业务不断复杂化，通常单一数据库在容量、性能上会遭遇瓶颈。通常的解决方案是向分库、分表的架构演进。此时，即引入了<strong>分库分表场景下</strong>的分布式事务场景。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景二跨服务场景下的分布式事务">场景二：跨服务场景下的分布式事务<a href="#场景二跨服务场景下的分布式事务" class="hash-link" aria-label="场景二：跨服务场景下的分布式事务的直接链接" title="场景二：跨服务场景下的分布式事务的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-跨服务场景下的分布式事务-ccc122e03531914d0945e82137912655.png" width="1200" height="647" class="img_ev3q">
降低单体应用复杂度的方案：应用微服务化拆分。拆分后，我们的产品由多个功能各异的微服务组件构成，每个微服务都使用独立的数据库资源。在涉及到跨服务调用的数据一致性场景时，就引入了<strong>跨服务场景下</strong>的分布式事务。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata架构">Seata架构<a href="#seata架构" class="hash-link" aria-label="Seata架构的直接链接" title="Seata架构的直接链接">​</a></h3><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-Seata架构-d45c1d1bf146b044c4f1b7f85ba3beb8.png" width="1534" height="908" class="img_ev3q">
其核心组件主要如下：</p><ul><li><strong>Transaction Coordinator（TC）</strong></li></ul><p>事务协调器，维护全局事务的运行状态，负责协调并驱动全局事务的提交或回滚。</p><ul><li><strong>Transaction Manager（TM）</strong></li></ul><p>控制全局事务的边界，负责开启一个全局事务，并最终发起全局提交或全局回滚的决议，TM定义全局事务的边界。</p><ul><li><strong>Resource Manager（RM）</strong></li></ul><p>控制分支事务，负责分支注册、状态汇报，并接收事务协调器的指令，驱动分支（本地）事务的提交和回滚。RM负责定义分支事务的边界和行为。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="seata的可观测实践">Seata的可观测实践<a href="#seata的可观测实践" class="hash-link" aria-label="Seata的可观测实践的直接链接" title="Seata的可观测实践的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么需要可观测">为什么需要可观测？<a href="#为什么需要可观测" class="hash-link" aria-label="为什么需要可观测？的直接链接" title="为什么需要可观测？的直接链接">​</a></h3><ul><li><strong>分布式事务消息链路较复杂</strong></li></ul><p>Seata在解决了用户易用性和分布式事务一致性这些问题的同时，需要多次TC与TM、RM之间的交互，尤其当微服务的链路变复杂时，Seata的交互链路也会呈正相关性增加。这种情况下，其实我们就需要引入可观测的能力来观察、分析事物链路。</p><ul><li><strong>异常链路、故障排查难定位，性能优化无从下手</strong></li></ul><p>在排查Seata的异常事务链路时，传统的方法需要看日志，这样检索起来比较麻烦。在引入可观测能力后，帮助我们直观的分析链路，快速定位问题；为优化耗时的事务链路提供依据。</p><ul><li><strong>可视化、数据可量化</strong></li></ul><p>可视化能力可让用户对事务执行情况有直观的感受；借助可量化的数据，可帮助用户评估资源消耗、规划预算。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="可观测能力概览">可观测能力概览<a href="#可观测能力概览" class="hash-link" aria-label="可观测能力概览的直接链接" title="可观测能力概览的直接链接">​</a></h3><table><thead><tr><th><strong>可观测维度</strong></th><th><strong>seata期望的能力</strong></th><th><strong>技术选型参考</strong></th></tr></thead><tbody><tr><td>Metrics</td><td>功能层面：可按业务分组隔离，采集事务总量、耗时等重要指标</td><td></td></tr></tbody></table><p>性能层面：高度量性能，插件按需加载
架构层面：减少第三方依赖，服务端、客户端能够采用统一的架构，减少技术复杂度
兼容性层面：至少兼容Prometheus生态 | Prometheus：指标存储和查询等领域有着业界领先的地位
OpenTelemetry：可观测数据采集和规范的事实标准。但自身并不负责数据的存储，展示和分析 |
| Tracing | 功能层面：全链路追踪分布式事务生命周期，反应分布式事务执行性能消耗
易用性方面：对使用seata的用户而言简单易接入 | SkyWalking：利用Java的Agent探针技术，效率高，简单易用。 |
| Logging | 功能层面：记录服务端、客户端全部生命周期信息
易用性层面：能根据XID快速匹配全局事务对应链路日志 | Alibaba Cloud Service
ELK |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics维度">Metrics维度<a href="#metrics维度" class="hash-link" aria-label="Metrics维度的直接链接" title="Metrics维度的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="设计思路">设计思路<a href="#设计思路" class="hash-link" aria-label="设计思路的直接链接" title="设计思路的直接链接">​</a></h4><ol><li>Seata作为一个被集成的数据一致性框架，Metrics模块将尽可能少的使用第三方依赖以降低发生冲突的风险</li><li>Metrics模块将竭力争取更高的度量性能和更低的资源开销，尽可能降低开启后带来的副作用</li><li>配置时，Metrics是否激活、数据如何发布，取决于对应的配置；开启配置则自动启用，并默认将度量数据通过prometheusexporter的形式发布</li><li>不使用Spring，使用SPI(Service Provider Interface)加载扩展</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="模块设计">模块设计<a href="#模块设计" class="hash-link" aria-label="模块设计的直接链接" title="模块设计的直接链接">​</a></h4><p><img loading="lazy" alt="图片 1.png" src="/zh-cn/assets/images/metrics-模块设计-44acf0482c9b8fbb5f6ec11a1423440c.png" width="1296" height="746" class="img_ev3q"></p><ul><li>seata-metrics-core：Metrics核心模块，根据配置组织（加载）1个Registry和N个Exporter；</li><li>seata-metrics-api：定义了Meter指标接口，Registry指标注册中心接口；</li><li>seata-metrics-exporter-prometheus：内置的prometheus-exporter实现；</li><li>seata-metrics-registry-compact：内置的Registry实现，并轻量级实现了Gauge、Counter、Summay、Timer指标；</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="metrics模块工作流">metrics模块工作流<a href="#metrics模块工作流" class="hash-link" aria-label="metrics模块工作流的直接链接" title="metrics模块工作流的直接链接">​</a></h4><p><img loading="lazy" alt="图片 1.png" src="/zh-cn/assets/images/metrics-模块工作流-cf55ed8598aa42930fb5d0c58399463d.png" width="1534" height="964" class="img_ev3q">
上图是metrics模块的工作流，其工作流程如下：</p><ol><li>利用SPI机制，根据配置加载Exporter和Registry的实现类；</li><li>基于消息订阅与通知机制，监听所有全局事务的状态变更事件，并publish到EventBus；</li><li>事件订阅者消费事件，并将生成的metrics写入Registry；</li><li>监控系统（如prometheus）从Exporter中拉取数据。</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tc核心指标">TC核心指标<a href="#tc核心指标" class="hash-link" aria-label="TC核心指标的直接链接" title="TC核心指标的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-TC核心指标-7de91006545ab3e5518b6889456a8302.png" width="1746" height="1072" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tm核心指标">TM核心指标<a href="#tm核心指标" class="hash-link" aria-label="TM核心指标的直接链接" title="TM核心指标的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-TM核心指标-8ef5523801c632ae5af707ade30576b5.png" width="2308" height="1094" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="rm核心指标">RM核心指标<a href="#rm核心指标" class="hash-link" aria-label="RM核心指标的直接链接" title="RM核心指标的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-RM核心指标-30ac5fe4e5c6e0d0727a3d28bf94ec82.png" width="2122" height="1580" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="大盘展示">大盘展示<a href="#大盘展示" class="hash-link" aria-label="大盘展示的直接链接" title="大盘展示的直接链接">​</a></h4><p><img loading="lazy" alt="lQLPJxZhZlqESU3NBpjNBp6w8zYK6VbMgzYCoKVrWEDWAA_1694_1688.png" src="/zh-cn/assets/images/metrics-大盘展示-1f6d2bdf7f5bc02f56244b361764ee7c.png" width="1694" height="1688" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tracing维度">Tracing维度<a href="#tracing维度" class="hash-link" aria-label="Tracing维度的直接链接" title="Tracing维度的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata为什么需要tracing">Seata为什么需要tracing？<a href="#seata为什么需要tracing" class="hash-link" aria-label="Seata为什么需要tracing？的直接链接" title="Seata为什么需要tracing？的直接链接">​</a></h4><ol><li>对业务侧而言，引入Seata后，对业务性能会带来多大损耗？主要时间消耗在什么地方？如何针对性的优化业务逻辑？这些都是未知的。</li><li>Seata的所有消息记录都通过日志持久化落盘，但对不了解Seata的用户而言，日志非常不友好。能否通过接入Tracing，提升事务链路排查效率？</li><li>对于新手用户，可通过Tracing记录，快速了解seata的工作原理，降低seata使用门槛。</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seata的tracing解决方案">Seata的tracing解决方案<a href="#seata的tracing解决方案" class="hash-link" aria-label="Seata的tracing解决方案的直接链接" title="Seata的tracing解决方案的直接链接">​</a></h4><ul><li>Seata在自定义的RPC消息协议中定义了Header信息；</li><li>SkyWalking拦截指定的RPC消息，并注入tracing相关的span信息；</li><li>以RPC消息的发出&amp;接收为临界点，定义了span的生命周期范围。</li></ul><p>基于上述的方式，Seata实现了事务全链路的tracing，具体接入可参考<a href="https://seata.io/zh-cn/docs/user/apm/skywalking.html" target="_blank" rel="noopener noreferrer">为[Seata应用 | Seata-server]接入Skywalking</a>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tracing效果">tracing效果<a href="#tracing效果" class="hash-link" aria-label="tracing效果的直接链接" title="tracing效果的直接链接">​</a></h4><ul><li>基于的demo场景：</li></ul><ol><li>用户请求交易服务</li><li>交易服务锁定库存</li><li>交易服务创建账单</li><li>账单服务进行扣款</li></ol><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-tracing效果-业务逻辑图-92ed3a1bb1fc62135d8d02d1a21951fb.png" width="865" height="489" class="img_ev3q"></p><ul><li>GlobalCommit成功的事务链路（事例）</li></ul><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-tracing效果-tracing链1-e4e8b13e4b0a74c76631560a66973d2a.png" width="1080" height="1788" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-tracing效果-tracing链2-d5a816ec8b49b6ca95309eeda8470825.png" width="1080" height="2647" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-tracing效果-tracing链3-c50deab1728f8e61946a26d7d1b49da8.png" width="1080" height="1466" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging维度">Logging维度<a href="#logging维度" class="hash-link" aria-label="Logging维度的直接链接" title="Logging维度的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="设计思路-1">设计思路<a href="#设计思路-1" class="hash-link" aria-label="设计思路的直接链接" title="设计思路的直接链接">​</a></h4><p><img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-logging设计思路-c90fe7b88cab305e7b3c918df2cba8b6.png" width="1434" height="454" class="img_ev3q">
Logging这一块其实承担的是可观测这几个维度当中的兜底角色。放在最底层的，其实就是我们日志格式的设计，只有好日志格式，我们才能对它进行更好的采集、模块化的存储和展示。在其之上，是日志的采集、存储、监控、告警、数据可视化，这些模块更多的是有现成的工具，比如阿里的SLS日志服务、还有ELK的一套技术栈，我们更多是将开销成本、接入复杂度、生态繁荣度等作为考量。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日志格式设计">日志格式设计<a href="#日志格式设计" class="hash-link" aria-label="日志格式设计的直接链接" title="日志格式设计的直接链接">​</a></h4><p>这里拿Seata-Server的一个日志格式作为案例：
<img loading="lazy" alt="image.png" src="/zh-cn/assets/images/metrics-logging日志效果-049f409856a4895fe3d27d7930e028f8.png" width="1342" height="364" class="img_ev3q"></p><ul><li>线程池规范命名：当线程池、线程比较多时，规范的线程命名能将无序执行的线程执行次序清晰展示。</li><li>方法全类名可追溯：快速定位到具体的代码块。</li><li>重点运行时信息透出：重点突出关键日志，不关键的日志不打印，减少日志冗余。</li><li>消息格式可扩展：通过扩展消息类的输出格式，减少日志的代码修改量。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结展望">总结&amp;展望<a href="#总结展望" class="hash-link" aria-label="总结&amp;展望的直接链接" title="总结&amp;展望的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Metrics的直接链接" title="Metrics的直接链接">​</a></h4><p>总结：基本实现分布式事务的可量化、可观测。
展望：更细粒度的指标、更广阔的生态兼容。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tracing">Tracing<a href="#tracing" class="hash-link" aria-label="Tracing的直接链接" title="Tracing的直接链接">​</a></h4><p>总结：分布式事务全链路的可追溯。
展望：根据xid追溯事务链路，异常链路根因快速定位。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Logging的直接链接" title="Logging的直接链接">​</a></h4><p>总结：结构化的日志格式。
展望：日志可观测体系演进。</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-go-1.2.0">生产环境可用的 seata-go 1.2.0 来了！！！</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-08T00:00:00.000Z" itemprop="datePublished">2023年6月8日</time> · <!-- -->阅读需 3 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Seata社区</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="生产环境可用的-seata-go-120-来了">生产环境可用的 seata-go 1.2.0 来了！！！<a href="#生产环境可用的-seata-go-120-来了" class="hash-link" aria-label="生产环境可用的 seata-go 1.2.0 来了！！！的直接链接" title="生产环境可用的 seata-go 1.2.0 来了！！！的直接链接">​</a></h2><p>Seata 是一款开源的分布式事务解决方案，提供高性能和简单易用的分布式事务服务。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="发布概览">发布概览<a href="#发布概览" class="hash-link" aria-label="发布概览的直接链接" title="发布概览的直接链接">​</a></h3><p>Seata-go 1.2.0 版本支持 XA 模式。XA 协议是由 X/Open 组织提出的分布式事务处理规范，其优点是对业务代码无侵入。当前 Seata-go 的 XA 模式支持 MySQL 数据库。至此，seata-go 已经集齐 AT、TCC、Saga 和 XA 四种事务模式，完成了与 Seata Java 的功能对齐。 XA 模式的主要功能:</p><ul><li>支持了 XA 数据源代理 </li><li>支持了 XA 事务模式<br>XA 相关的 samples 可以参考示例：<a href="https://github.com/seata/seata-go-samples/tree/main/xa" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-go-samples/tree/main/xa</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature">feature：<a href="#feature" class="hash-link" aria-label="feature：的直接链接" title="feature：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata-go/pull/467" target="_blank" rel="noopener noreferrer">#467</a>] 实现 XA 模式支持 MySQL</li><li>[<a href="https://github.com/seata/seata-go/pull/534" target="_blank" rel="noopener noreferrer">#534</a>] 支持 session 的负载均衡</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bugfix">bugfix：<a href="#bugfix" class="hash-link" aria-label="bugfix：的直接链接" title="bugfix：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata-go/pull/540" target="_blank" rel="noopener noreferrer">#540</a>] 修复初始化 xa 模式的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/545" target="_blank" rel="noopener noreferrer">#545</a>] 修复 xa 模式获取 db 版本号的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/548" target="_blank" rel="noopener noreferrer">#548</a>] 修复启动 xa 会失败的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/556" target="_blank" rel="noopener noreferrer">#556</a>] 修复 xa 数据源的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/562" target="_blank" rel="noopener noreferrer">#562</a>] 修复提交 xa 全局事务的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/564" target="_blank" rel="noopener noreferrer">#564</a>] 修复提交 xa 分支事务的 bug</li><li>[<a href="https://github.com/seata/seata-go/pull/566" target="_blank" rel="noopener noreferrer">#566</a>] 修复使用 xa 数据源执行本地事务的 bug</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimize">optimize:<a href="#optimize" class="hash-link" aria-label="optimize:的直接链接" title="optimize:的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata-go/pull/523" target="_blank" rel="noopener noreferrer">#523</a>] 优化 CI 流程</li><li>[<a href="https://github.com/seata/seata-go/pull/456" target="_blank" rel="noopener noreferrer">#525</a>] 将 jackson 序列化重命名为 json</li><li>[<a href="https://github.com/seata/seata-go/pull/532" target="_blank" rel="noopener noreferrer">#532</a>] 移除重复的代码</li><li>[<a href="https://github.com/seata/seata-go/pull/536" target="_blank" rel="noopener noreferrer">#536</a>] 优化 go import 代码格式</li><li>[<a href="https://github.com/seata/seata-go/pull/554" target="_blank" rel="noopener noreferrer">#554</a>] 优化 xa 模式的性能</li><li>[<a href="https://github.com/seata/seata-go/pull/561" target="_blank" rel="noopener noreferrer">#561</a>] 优化 xa 模式的日志输出</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test">test:<a href="#test" class="hash-link" aria-label="test:的直接链接" title="test:的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata-go/pull/535" target="_blank" rel="noopener noreferrer">#535</a>] 添加集成测试</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="doc">doc:<a href="#doc" class="hash-link" aria-label="doc:的直接链接" title="doc:的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata-go/pull/550" target="_blank" rel="noopener noreferrer">#550</a>] 添加 1.2.0 版本的改动日志</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="contributors">contributors:<a href="#contributors" class="hash-link" aria-label="contributors:的直接链接" title="contributors:的直接链接">​</a></h3><p>Thanks to these contributors for their code commits. Please report an unintended omission.</p><ul><li><a href="https://github.com/georgehao" target="_blank" rel="noopener noreferrer">georgehao</a></li><li><a href="https://github.com/luky116" target="_blank" rel="noopener noreferrer">luky116</a></li><li><a href="https://github.com/jasondeng1997" target="_blank" rel="noopener noreferrer">jasondeng1997</a></li><li><a href="https://github.com/106umao" target="_blank" rel="noopener noreferrer">106umao</a></li><li><a href="https://github.com/wang1309" target="_blank" rel="noopener noreferrer">wang1309</a></li><li><a href="https://github.com/iSuperCoder" target="_blank" rel="noopener noreferrer">iSuperCoder</a></li><li><a href="https://github.com/Charlie17Li" target="_blank" rel="noopener noreferrer">Charlie17Li</a></li><li><a href="https://github.com/Code-Fight" target="_blank" rel="noopener noreferrer">Code-Fight</a></li><li><a href="https://github.com/Kirhaku" target="_blank" rel="noopener noreferrer">Kirhaku</a></li><li><a href="https://github.com/VaderKai" target="_blank" rel="noopener noreferrer">Vaderkai</a></li></ul><p>同时，我们收到了社区反馈的很多有价值的issue和建议，非常感谢大家。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="link">Link<a href="#link" class="hash-link" aria-label="Link的直接链接" title="Link的直接链接">​</a></h4><ul><li><a href="http://github.com/seata/seata" target="_blank" rel="noopener noreferrer">http://github.com/seata/seata</a></li><li><a href="https://github.com/seata/seata-php" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-php</a></li><li><a href="https://github.com/seata/seata-js" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-js</a></li><li><a href="https://github.com/seata/seata-go" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-go</a><br><strong>Samples：</strong></li><li><a href="https://github.com/seata/seata-samples" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-samples</a></li><li><a href="https://github.com/seata/seata-go-samples" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-go-samples</a><br><strong>官网：</strong>   </li><li><a href="https://seata.io/" target="_blank" rel="noopener noreferrer">https://seata.io/</a></li></ul></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/iscas2023">6大课题现已开放挑选 | 欢迎报名 Seata 开源之夏</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-05-12T00:00:00.000Z" itemprop="datePublished">2023年5月12日</time> · <!-- -->阅读需 11 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Seata社区</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="欢迎大家报名seata-开源之夏2023课题">欢迎大家报名Seata 开源之夏2023课题<a href="#欢迎大家报名seata-开源之夏2023课题" class="hash-link" aria-label="欢迎大家报名Seata 开源之夏2023课题的直接链接" title="欢迎大家报名Seata 开源之夏2023课题的直接链接">​</a></h3><p>开源之夏 2023 学生报名期为 <strong>4 月 29 日-6月4日</strong>，欢迎报名Seata 2023 课题！在这里，您将有机会深入探讨分布式事务的理论和应用，并与来自不同背景的同学一起合作完成实践项目。我们期待着您的积极参与和贡献，共同推动分布式事务领域的发展。</p><p><img loading="lazy" alt="summer2023-1" src="/zh-cn/assets/images/summer2023-1-354d728bacb1640f84811b82ac954a9d.jpg" width="1290" height="2796" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开源之夏2023">开源之夏2023<a href="#开源之夏2023" class="hash-link" aria-label="开源之夏2023的直接链接" title="开源之夏2023的直接链接">​</a></h3><p>开源之夏是由中科院软件所“开源软件供应链点亮计划”发起并长期支持的一项暑期开源活动，旨在鼓励在校学生积极参与开源软件的开发维护，培养和发掘更多优秀的开发者，促进优秀开源软件社区的蓬勃发展，助力开源软件供应链建设。</p><p>参与学生通过远程线上协作方式，配有资深导师指导，参与到开源社区各组织项目开发中并收获奖金、礼品与证书。<strong>这些收获，不仅仅是未来毕业简历上浓墨重彩的一笔，更是迈向顶尖开发者的闪亮起点，可以说非常值得一试。</strong>  每个项目难度分为基础和进阶两档，对应学生结项奖金分别为税前人民币 8000 元和税前人民币 12000 元。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata社区介绍">Seata社区介绍<a href="#seata社区介绍" class="hash-link" aria-label="Seata社区介绍的直接链接" title="Seata社区介绍的直接链接">​</a></h3><p><strong>Seata</strong> 是一款开源的分布式事务解决方案，GitHub获得超过23K+ Starts致力于在微服务架构下提供高性能和简单易用的分布式事务服务。在 Seata 开源之前，Seata 在阿里内部一直扮演着分布式数据一致性的中间件角色，几乎每笔交易都要使用Seata，历经双11洪荒流量的洗礼，对业务进行了有力的技术支撑。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata社区开源之夏2023项目课题汇总">Seata社区开源之夏2023项目课题汇总<a href="#seata社区开源之夏2023项目课题汇总" class="hash-link" aria-label="Seata社区开源之夏2023项目课题汇总的直接链接" title="Seata社区开源之夏2023项目课题汇总的直接链接">​</a></h3><p>Seata社区为开源之夏2023组委会推荐6项精选项目课题，您可以访问以下链接进行选报：<br>
<a href="https://summer-ospp.ac.cn/org/orgdetail/064c15df-705c-483a-8fc8-02831370db14?lang=zh" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/orgdetail/064c15df-705c-483a-8fc8-02831370db14?lang=zh</a><br>
<!-- -->请及时与各导师沟通并准备项目申请材料，并登录官方注册申报（以下课题顺序不分先后）：
<img loading="lazy" alt="seata2023-2" src="/zh-cn/assets/images/summer2023-2-cff41105a59822fdd5e8d88d84ad0e2a.png" width="706" height="271" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目一-实现用于服务发现和注册的namingserver">项目一: 实现用于服务发现和注册的NamingServer<a href="#项目一-实现用于服务发现和注册的namingserver" class="hash-link" aria-label="项目一: 实现用于服务发现和注册的NamingServer的直接链接" title="项目一: 实现用于服务发现和注册的NamingServer的直接链接">​</a></h4><p><strong>难度：</strong> 进阶/Advanced</p><p><strong>项目社区导师：</strong> 陈健斌</p><p><strong>导师联系邮箱：</strong> <a href="mailto:364176773@qq.com" target="_blank" rel="noopener noreferrer">364176773@qq.com</a></p><p><strong>项目简述：</strong><br>
<!-- -->目前seata的服务暴露及发现主要依赖于第三方注册中心，随着项目的演进发展，带来了额外的学习使用成本，而业内主流具有服务端的中间件大多都开始演进自身的服务自闭环和控制及提供于服务端更高契合度和可靠性的组件或功能如kafka 的KRaft，rocketmq的NameServer，clickhouse的ClickHouse Keeper等.故为了解决如上问题和架构演进要求,seata需要构建自身的nameserver来保证更加稳定可靠。</p><p><strong>项目链接：</strong>
<a href="https://summer-ospp.ac.cn/org/prodetail/230640380?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640380?list=org&amp;navpage=org</a></p><br><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目二-在seata-go中实现saga事务模式">项目二: 在seata-go中实现saga事务模式<a href="#项目二-在seata-go中实现saga事务模式" class="hash-link" aria-label="项目二: 在seata-go中实现saga事务模式的直接链接" title="项目二: 在seata-go中实现saga事务模式的直接链接">​</a></h4><p><strong>难度：</strong> 进阶/Advanced</p><p><strong>项目社区导师：</strong> 刘月财</p><p><strong>导师联系邮箱：</strong> <a href="mailto:luky116@apache.org" target="_blank" rel="noopener noreferrer">luky116@apache.org</a></p><p><strong>项目简述：</strong>
Saga模式是SEATA提供的长事务解决方案，在Saga模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务都由业务开发实现。Seata-go 中当前没有支持saga模式，希望后面参考Java版本的实现能将该功能支持上。</p><p><strong>项目链接：</strong>
<a href="https://summer-ospp.ac.cn/org/prodetail/230640382?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640382?list=org&amp;navpage=org</a></p><br><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目三-seata-saga模式产品化能力提升">项目三: seata saga模式产品化能力提升<a href="#项目三-seata-saga模式产品化能力提升" class="hash-link" aria-label="项目三: seata saga模式产品化能力提升的直接链接" title="项目三: seata saga模式产品化能力提升的直接链接">​</a></h4><p><strong>难度：</strong> 进阶/Advanced</p><p><strong>项目社区导师：</strong> 李宗杰</p><p><strong>导师联系邮箱：</strong> <a href="mailto:leezongjie@163.com" target="_blank" rel="noopener noreferrer">leezongjie@163.com</a></p><p><strong>项目简述：</strong>
saga作为分布式事务的解决方案之一，在长事务上应用尤其广泛，seata也提供了对应的状态机实现。随着业务的不断发展和接入，对seata提出了更高的要求，我们需要支持流式saga 编排，对当前状态机的实现进行优化和扩展，进一步服务业务。</p><p><strong>项目链接：</strong>
<a href="https://summer-ospp.ac.cn/org/prodetail/230640415?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640415?list=org&amp;navpage=org</a></p><br><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目四--增加控制台事务控制能力">项目四:  增加控制台事务控制能力<a href="#项目四--增加控制台事务控制能力" class="hash-link" aria-label="项目四:  增加控制台事务控制能力的直接链接" title="项目四:  增加控制台事务控制能力的直接链接">​</a></h4><p><strong>难度：</strong> 进阶/Advanced</p><p><strong>项目社区导师：</strong> 王良</p><p><strong>导师联系邮箱：</strong> <a href="mailto:841369634@qq.com" target="_blank" rel="noopener noreferrer">841369634@qq.com</a></p><p><strong>项目简述：</strong>
在分布式事务中，经常会存在非常多的异常情况，这些异常情况往往会导致系统无法继续运行。而这些异常往往需要人工介入排查原因并排除故障，才能够使系统继续正常运行。虽然seata 提供了控制台查询事务数据，但还未提供任何事务控制能力，帮助排除故障。所以，本课题主要是在seata服务端控制台上，添加事务控制能力。</p><p><strong>项目链接：</strong>
<a href="https://summer-ospp.ac.cn/org/prodetail/230640423?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640423?list=org&amp;navpage=org</a></p><br><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目五--提高单测覆盖率和建立集成测试">项目五:  提高单测覆盖率和建立集成测试<a href="#项目五--提高单测覆盖率和建立集成测试" class="hash-link" aria-label="项目五:  提高单测覆盖率和建立集成测试的直接链接" title="项目五:  提高单测覆盖率和建立集成测试的直接链接">​</a></h4><p><strong>难度：</strong> 基础/Basic</p><p><strong>项目社区导师：</strong> 张嘉伟</p><p><strong>导师联系邮箱：</strong> <a href="mailto:349071347@qq.com" target="_blank" rel="noopener noreferrer">349071347@qq.com</a></p><p><strong>项目简述：</strong>
为了进一步提高项目的质量以及稳定性, 需要进一步提升项目单元测试覆盖率以及加入集成测试来模拟生产中不同的场景. 集成测试的目的是为了模拟client与server的交互过程, 而非单一的对某个接口进行测试。</p><p><strong>项目链接：</strong>
<a href="https://summer-ospp.ac.cn/org/prodetail/230640424?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640424?list=org&amp;navpage=org</a></p><br><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="项目六-实现seata运维ctl工具">项目六: 实现Seata运维ctl工具<a href="#项目六-实现seata运维ctl工具" class="hash-link" aria-label="项目六: 实现Seata运维ctl工具的直接链接" title="项目六: 实现Seata运维ctl工具的直接链接">​</a></h4><p><strong>难度：</strong> 进阶/Advanced</p><p><strong>项目社区导师：</strong> 季敏</p><p><strong>导师联系邮箱：</strong>  <a href="mailto:jimin.jm@alibaba-inc.com" target="_blank" rel="noopener noreferrer">jimin.jm@alibaba-inc.com</a></p><p><strong>项目简述：</strong> 运维ctl命令在Seata中非常重要，它是Seata的命令行工具，可以帮助我们管理和操作Seata的各种组件。运维ctl命令可以让我们快速地启动、停止和管理Seata服务，定位和解决问题。此外，运维ctl 命令还提供了丰富的指令，可以让我们方便地检查Seata的健康状态、模拟事务和打印导出配置信息等，大大提高了我们的工作效率和运维体验。</p><p>以下是对实现定制ctl运维命令行的一些建议： </p><ul><li>借鉴其他开源项目的实现方式，比如kubectl，helm等，并根据Seata的特点和需求进行定制。</li><li>将常用的运维操作直接封装进命令行，减少用户的手动操作。</li><li>考虑使用友好的命令和参数名称，将命令行设计得易于理解和记忆。</li><li>提供详细的帮助文档和示例，帮助用户快速上手和了解如何使用各种参数和选项。</li><li>考虑命令行的跨平台支持，例如支持Windows、Linux和MacOS等操作系统。
一款好的ctl命令行应该是易用、灵活、可定制、健壮和易维护的。</li></ul><p>项目链接：<a href="https://summer-ospp.ac.cn/org/prodetail/230640431?list=org&amp;navpage=org" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/prodetail/230640431?list=org&amp;navpage=org</a></p><br><br><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何参与开源之夏2023并快速选定项目">如何参与开源之夏2023并快速选定项目？<a href="#如何参与开源之夏2023并快速选定项目" class="hash-link" aria-label="如何参与开源之夏2023并快速选定项目？的直接链接" title="如何参与开源之夏2023并快速选定项目？的直接链接">​</a></h3><p><strong>欢迎通过上方联系方式，与各导师沟通并准备项目申请材料。</strong></p><p>课题参与期间，学生可以在世界任何地方线上工作，Seata相关项目结项需要在<strong>9月30日</strong>前以 PR 的形式提交到Seata社区仓库中并完成合并，请务必尽早准备。
<img loading="lazy" alt="seata2023-3" src="/zh-cn/assets/images/summer2023-3-9b3b418ef64bd3c1afb2782d17af315a.png" width="1080" height="471" class="img_ev3q"></p><p><strong>需要在课题期间第一时间获取导师及其他信息,可扫码进入钉钉群交流</strong> ——了解Seata社区各领域项目、结识Seata社区开源导师，以助力后续申请。</p><br><img loading="lazy" src="/img/blog/summer2023-4.jpg" height="290" width="250" class="img_ev3q"><br><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考资料">参考资料：<a href="#参考资料" class="hash-link" aria-label="参考资料：的直接链接" title="参考资料：的直接链接">​</a></h4><p><strong>Seata网站 :</strong>  <a href="https://seata.io/" target="_blank" rel="noopener noreferrer">https://seata.io/</a></p><p><strong>Seata GitHub :</strong> <a href="https://github.com/seata" target="_blank" rel="noopener noreferrer">https://github.com/seata</a></p><p><strong>开源之夏官网：</strong> <a href="https://summer-ospp.ac.cn/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64?lang=zh" target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.cn/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64?lang=zh</a></p><p>如果同学们对微服务其他领域项目感兴趣，也可以尝试申请，例如：</p><ul><li>对于<strong>微服务配置注册中心</strong>有兴趣的同学，可以尝试填报<a href="https://nacos.io/zh-cn/blog/iscas2023.html" target="_blank" rel="noopener noreferrer">Nacos 开源之夏</a>；</li><li>对于<strong>微服务框架和RPC框架</strong>有兴趣的同学，可以尝试填报<a href="https://summer-ospp.ac.cn/org/orgdetail/41d68399-ed48-4d6d-9d4d-3ff4128dc132?lang=zh" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba 开源之夏</a> 和 <a href="https://summer-ospp.ac.cn/org/orgdetail/a7f6e2ad-4acc-47f8-9471-4e54b9a166a6?lang=zh" target="_blank" rel="noopener noreferrer">Dubbo 开源之夏</a> ；</li><li>对于<strong>云原生网关</strong>有兴趣的同学，可以尝试填报<a href="https://higress.io/zh-cn/blog/ospp-2023" target="_blank" rel="noopener noreferrer">Higress 开源之夏</a>；</li><li>对于<strong>分布式高可用防护</strong>有兴趣的同学，可以尝试填报 <!-- -->[Sentinel 开源之夏]<!-- -->(<a href="https://summer-ospp.ac." target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.</a> cn/org/orgdetail/5e879522-bd90-4a8b-bf8b-b11aea48626b?lang=zh) ；</li><li>对于<strong>微服务治理</strong>有兴趣的同学，可以尝试填报  <!-- -->[OpenSergo 开源之夏]<!-- -->(<a href="https://summer-ospp.ac." target="_blank" rel="noopener noreferrer">https://summer-ospp.ac.</a> cn/org/orgdetail/aaff4eec-11b1-4375-997d-5eea8f51762b?lang=zh)。</li></ul></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-1.6.0">Seata 1.6.0 重磅发布，大幅提升性能</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-17T00:00:00.000Z" itemprop="datePublished">2022年12月17日</time> · <!-- -->阅读需 7 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Seata社区</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-160-重磅发布大幅提升性能">Seata 1.6.0 重磅发布，大幅提升性能<a href="#seata-160-重磅发布大幅提升性能" class="hash-link" aria-label="Seata 1.6.0 重磅发布，大幅提升性能的直接链接" title="Seata 1.6.0 重磅发布，大幅提升性能的直接链接">​</a></h3><p>Seata 是一款开源的分布式事务解决方案，提供高性能和简单易用的分布式事务服务。</p><p><strong>seata-server 下载链接：</strong></p><p><a href="https://github.com/seata/seata/archive/v1.6.0.zip" target="_blank" rel="noopener noreferrer">source</a> |
<a href="https://github.com/seata/seata/releases/download/v1.6.0/seata-server-1.6.0.zip" target="_blank" rel="noopener noreferrer">binary</a></p><p>此版本更新如下：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature">feature：<a href="#feature" class="hash-link" aria-label="feature：的直接链接" title="feature：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4863" target="_blank" rel="noopener noreferrer">#4863</a>] 支持 oracle 和 postgresql 多主键</li><li>[<a href="https://github.com/seata/seata/pull/4649" target="_blank" rel="noopener noreferrer">#4649</a>] seata-server支持多注册中心</li><li>[<a href="https://github.com/seata/seata/pull/4779" target="_blank" rel="noopener noreferrer">#4779</a>] 支持 Apache Dubbo3</li><li>[<a href="https://github.com/seata/seata/pull/4479" target="_blank" rel="noopener noreferrer">#4479</a>] TCC注解支持添加在接口和实现类上</li><li>[<a href="https://github.com/seata/seata/pull/4877" target="_blank" rel="noopener noreferrer">#4877</a>] client sdk 支持jdk17</li><li>[<a href="https://github.com/seata/seata/pull/4914" target="_blank" rel="noopener noreferrer">#4914</a>] 支持 mysql 的update join联表更新语法</li><li>[<a href="https://github.com/seata/seata/pull/4542" target="_blank" rel="noopener noreferrer">#4542</a>] 支持 oracle timestamp 类型</li><li>[<a href="https://github.com/seata/seata/pull/5111" target="_blank" rel="noopener noreferrer">#5111</a>] 支持Nacos contextPath 配置</li><li>[<a href="https://github.com/seata/seata/pull/4802" target="_blank" rel="noopener noreferrer">#4802</a>] dockerfile 支持 arm64</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bugfix">bugfix：<a href="#bugfix" class="hash-link" aria-label="bugfix：的直接链接" title="bugfix：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4780" target="_blank" rel="noopener noreferrer">#4780</a>] 修复超时回滚成功后无法发送TimeoutRollbacked事件</li><li>[<a href="https://github.com/seata/seata/pull/4954" target="_blank" rel="noopener noreferrer">#4954</a>] 修复output表达式错误时，保存执行结果空指针异常</li><li>[<a href="https://github.com/seata/seata/pull/4817" target="_blank" rel="noopener noreferrer">#4817</a>] 修复高版本springboot配置不标准的问题</li><li>[<a href="https://github.com/seata/seata/pull/4838" target="_blank" rel="noopener noreferrer">#4838</a>] 修复使用 Statement.executeBatch() 时无法生成undo log 的问题</li><li>[<a href="https://github.com/seata/seata/pull/4533" target="_blank" rel="noopener noreferrer">#4533</a>] 修复handleRetryRollbacking的event重复导致的指标数据不准确</li><li>[<a href="https://github.com/seata/seata/pull/4912" target="_blank" rel="noopener noreferrer">#4912</a>] 修复mysql InsertOnDuplicateUpdate 列名大小写不一致无法正确匹配</li><li>[<a href="https://github.com/seata/seata/pull/4543" target="_blank" rel="noopener noreferrer">#4543</a>] 修复对 Oracle 数据类型nclob的支持</li><li>[<a href="https://github.com/seata/seata/pull/4915" target="_blank" rel="noopener noreferrer">#4915</a>] 修复获取不到ServerRecoveryProperties属性的问题</li><li>[<a href="https://github.com/seata/seata/pull/4919" target="_blank" rel="noopener noreferrer">#4919</a>] 修复XID的port和address出现null:0的情况</li><li>[<a href="https://github.com/seata/seata/pull/4928" target="_blank" rel="noopener noreferrer">#4928</a>] 修复 rpcContext.getClientRMHolderMap NPE 问题</li><li>[<a href="https://github.com/seata/seata/pull/4953" target="_blank" rel="noopener noreferrer">#4953</a>] 修复InsertOnDuplicateUpdate可绕过修改主键的问题</li><li>[<a href="https://github.com/seata/seata/pull/4978" target="_blank" rel="noopener noreferrer">#4978</a>] 修复 kryo 支持循环依赖</li><li>[<a href="https://github.com/seata/seata/pull/4985" target="_blank" rel="noopener noreferrer">#4985</a>] 修复 undo_log id重复的问题</li><li>[<a href="https://github.com/seata/seata/pull/4874" target="_blank" rel="noopener noreferrer">#4874</a>] 修复OpenJDK 11 启动失败</li><li>[<a href="https://github.com/seata/seata/pull/5018" target="_blank" rel="noopener noreferrer">#5018</a>] 修复启动脚本中 loader path 使用相对路径导致 server 启动失败问题</li><li>[<a href="https://github.com/seata/seata/pull/5004" target="_blank" rel="noopener noreferrer">#5004</a>] 修复mysql update join行数据重复的问题</li><li>[<a href="https://github.com/seata/seata/pull/5032" target="_blank" rel="noopener noreferrer">#5032</a>] 修复mysql InsertOnDuplicateUpdate中条件参数填充位置计算错误导致的镜像查询SQL语句异常问题</li><li>[<a href="https://github.com/seata/seata/pull/5033" target="_blank" rel="noopener noreferrer">#5033</a>] 修复InsertOnDuplicateUpdate的SQL语句中无插入列字段导致的空指针问题</li><li>[<a href="https://github.com/seata/seata/pull/5038" target="_blank" rel="noopener noreferrer">#5038</a>] 修复SagaAsyncThreadPoolProperties冲突问题</li><li>[<a href="https://github.com/seata/seata/pull/5050" target="_blank" rel="noopener noreferrer">#5050</a>] 修复Saga模式下全局状态未正确更改成Committed问题</li><li>[<a href="https://github.com/seata/seata/pull/5052" target="_blank" rel="noopener noreferrer">#5052</a>] 修复update join条件中占位符参数问题</li><li>[<a href="https://github.com/seata/seata/pull/5031" target="_blank" rel="noopener noreferrer">#5031</a>] 修复InsertOnDuplicateUpdate中不应该使用null值索引作为查询条件</li><li>[<a href="https://github.com/seata/seata/pull/5075" target="_blank" rel="noopener noreferrer">#5075</a>] 修复InsertOnDuplicateUpdate无法拦截无主键和唯一索引的SQL</li><li>[<a href="https://github.com/seata/seata/pull/5093" target="_blank" rel="noopener noreferrer">#5093</a>] 修复seata server重启后accessKey丢失问题</li><li>[<a href="https://github.com/seata/seata/pull/5092" target="_blank" rel="noopener noreferrer">#5092</a>] 修复当seata and jpa共同使用时, AutoConfiguration的顺序不正确的问题</li><li>[<a href="https://github.com/seata/seata/pull/5109" target="_blank" rel="noopener noreferrer">#5109</a>] 修复当RM侧没有加@GlobalTransactional报NPE的问题</li><li>[<a href="https://github.com/seata/seata/pull/5098" target="_blank" rel="noopener noreferrer">#5098</a>] Druid 禁用 oracle implicit cache</li><li>[<a href="https://github.com/seata/seata/pull/4860" target="_blank" rel="noopener noreferrer">#4860</a>] 修复metrics tag覆盖问题</li><li>[<a href="https://github.com/seata/seata/pull/5028" target="_blank" rel="noopener noreferrer">#5028</a>] 修复 insert on duplicate SQL中 null 值问题</li><li>[<a href="https://github.com/seata/seata/pull/5078" target="_blank" rel="noopener noreferrer">#5078</a>] 修复SQL语句中无主键和唯一键拦截问题</li><li>[<a href="https://github.com/seata/seata/pull/5097" target="_blank" rel="noopener noreferrer">#5097</a>] 修复当Server重启时 accessKey 丢失问题</li><li>[<a href="https://github.com/seata/seata/pull/5131" target="_blank" rel="noopener noreferrer">#5131</a>] 修复XAConn处于active状态时无法回滚的问题</li><li>[<a href="https://github.com/seata/seata/pull/5134" target="_blank" rel="noopener noreferrer">#5134</a>] 修复hikariDataSource 自动代理在某些情况下失效的问题</li><li>[<a href="https://github.com/seata/seata/pull/5163" target="_blank" rel="noopener noreferrer">#5163</a>] 修复高版本JDK编译失败的问题</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimize">optimize：<a href="#optimize" class="hash-link" aria-label="optimize：的直接链接" title="optimize：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4681" target="_blank" rel="noopener noreferrer">#4681</a>] 优化竞争锁过程</li><li>[<a href="https://github.com/seata/seata/pull/4774" target="_blank" rel="noopener noreferrer">#4774</a>] 优化 seataio/seata-server 镜像中的 mysql8 依赖</li><li>[<a href="https://github.com/seata/seata/pull/4750" target="_blank" rel="noopener noreferrer">#4750</a>] 优化AT分支释放全局锁不使用xid</li><li>[<a href="https://github.com/seata/seata/pull/4790" target="_blank" rel="noopener noreferrer">#4790</a>] 添加自动发布 OSSRH github action</li><li>[<a href="https://github.com/seata/seata/pull/4765" target="_blank" rel="noopener noreferrer">#4765</a>] mysql8.0.29版本及以上XA模式不持connection至二阶段</li><li>[<a href="https://github.com/seata/seata/pull/4797" target="_blank" rel="noopener noreferrer">#4797</a>] 优化所有github actions脚本</li><li>[<a href="https://github.com/seata/seata/pull/4800" target="_blank" rel="noopener noreferrer">#4800</a>] 添加 NOTICE 文件</li><li>[<a href="https://github.com/seata/seata/pull/4761" target="_blank" rel="noopener noreferrer">#4761</a>] 使用 hget 代替 RedisLocker 中的 hmget</li><li>[<a href="https://github.com/seata/seata/pull/4414" target="_blank" rel="noopener noreferrer">#4414</a>] 移除log4j依赖</li><li>[<a href="https://github.com/seata/seata/pull/4836" target="_blank" rel="noopener noreferrer">#4836</a>] 优化 BaseTransactionalExecutor#buildLockKey(TableRecords rowsIncludingPK) 方法可读性</li><li>[<a href="https://github.com/seata/seata/pull/4865" target="_blank" rel="noopener noreferrer">#4865</a>] 修复 Saga 可视化设计器 GGEditor 安全漏洞</li><li>[<a href="https://github.com/seata/seata/pull/4590" target="_blank" rel="noopener noreferrer">#4590</a>] 自动降级支持开关支持动态配置</li><li>[<a href="https://github.com/seata/seata/pull/4490" target="_blank" rel="noopener noreferrer">#4490</a>] tccfence 记录表优化成按索引删除</li><li>[<a href="https://github.com/seata/seata/pull/4911" target="_blank" rel="noopener noreferrer">#4911</a>] 添加 header 和license 检测</li><li>[<a href="https://github.com/seata/seata/pull/4917" target="_blank" rel="noopener noreferrer">#4917</a>] 升级 package-lock.json 修复漏洞</li><li>[<a href="https://github.com/seata/seata/pull/4924" target="_blank" rel="noopener noreferrer">#4924</a>] 优化 pom 依赖</li><li>[<a href="https://github.com/seata/seata/pull/4932" target="_blank" rel="noopener noreferrer">#4932</a>] 抽取部分配置的默认值</li><li>[<a href="https://github.com/seata/seata/pull/4925" target="_blank" rel="noopener noreferrer">#4925</a>] 优化 javadoc 注释</li><li>[<a href="https://github.com/seata/seata/pull/4921" target="_blank" rel="noopener noreferrer">#4921</a>] 修复控制台模块安全漏洞和升级 skywalking-eyes 版本</li><li>[<a href="https://github.com/seata/seata/pull/4936" target="_blank" rel="noopener noreferrer">#4936</a>] 优化存储配置的读取</li><li>[<a href="https://github.com/seata/seata/pull/4946" target="_blank" rel="noopener noreferrer">#4946</a>] 将获取锁时遇到的sql异常传递给客户端</li><li>[<a href="https://github.com/seata/seata/pull/4962" target="_blank" rel="noopener noreferrer">#4962</a>] 优化构建配置，并修正docker镜像的基础镜像</li><li>[<a href="https://github.com/seata/seata/pull/4974" target="_blank" rel="noopener noreferrer">#4974</a>] 取消redis模式下,查询globalStatus数量的限制</li><li>[<a href="https://github.com/seata/seata/pull/4981" target="_blank" rel="noopener noreferrer">#4981</a>] 优化当tcc fence记录查不到时的错误提示</li><li>[<a href="https://github.com/seata/seata/pull/4995" target="_blank" rel="noopener noreferrer">#4995</a>] 修复mysql InsertOnDuplicateUpdate后置镜像查询SQL中重复的主键查询条件</li><li>[<a href="https://github.com/seata/seata/pull/5047" target="_blank" rel="noopener noreferrer">#5047</a>] 移除无用代码</li><li>[<a href="https://github.com/seata/seata/pull/5051" target="_blank" rel="noopener noreferrer">#5051</a>] 回滚时undolog产生脏写需要抛出不再重试(BranchRollbackFailed_Unretriable)的异常</li><li>[<a href="https://github.com/seata/seata/pull/5075" target="_blank" rel="noopener noreferrer">#5075</a>] 拦截没有主键及唯一索引值的insert on duplicate update语句</li><li>[<a href="https://github.com/seata/seata/pull/5104" target="_blank" rel="noopener noreferrer">#5104</a>] ConnectionProxy脱离对druid的依赖</li><li>[<a href="https://github.com/seata/seata/pull/5124" target="_blank" rel="noopener noreferrer">#5124</a>] 支持oracle删除TCC fence记录表</li><li>[<a href="https://github.com/seata/seata/pull/4968" target="_blank" rel="noopener noreferrer">#4468</a>] 支持kryo 5.3.0</li><li>[<a href="https://github.com/seata/seata/pull/4807" target="_blank" rel="noopener noreferrer">#4807</a>] 优化镜像和OSS仓库发布流水线</li><li>[<a href="https://github.com/seata/seata/pull/4445" target="_blank" rel="noopener noreferrer">#4445</a>] 优化事务超时判断</li><li>[<a href="https://github.com/seata/seata/pull/4958" target="_blank" rel="noopener noreferrer">#4958</a>] 优化超时事务 triggerAfterCommit() 的执行</li><li>[<a href="https://github.com/seata/seata/pull/4582" target="_blank" rel="noopener noreferrer">#4582</a>] 优化redis存储模式的事务排序</li><li>[<a href="https://github.com/seata/seata/pull/4963" target="_blank" rel="noopener noreferrer">#4963</a>] 增加 ARM64 流水线 CI 测试</li><li>[<a href="https://github.com/seata/seata/pull/4434" target="_blank" rel="noopener noreferrer">#4434</a>] 移除 seata-server CMS GC 参数</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test">test：<a href="#test" class="hash-link" aria-label="test：的直接链接" title="test：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4411" target="_blank" rel="noopener noreferrer">#4411</a>] 测试Oracle数据库AT模式下类型支持</li><li>[<a href="https://github.com/seata/seata/pull/4794" target="_blank" rel="noopener noreferrer">#4794</a>] 重构代码，尝试修复单元测试 <code>DataSourceProxyTest.getResourceIdTest()</code></li><li>[<a href="https://github.com/seata/seata/pull/5101" target="_blank" rel="noopener noreferrer">#5101</a>] 修复zk注册和配置中心报ClassNotFoundException的问题 <code>DataSourceProxyTest.getResourceIdTest()</code></li></ul><p>非常感谢以下 contributors 的代码贡献。若有无意遗漏，请报告。</p><ul><li><a href="https://github.com/slievrly" target="_blank" rel="noopener noreferrer">slievrly</a></li><li><a href="https://github.com/renliangyu857" target="_blank" rel="noopener noreferrer">renliangyu857</a></li><li><a href="https://github.com/wangliang181230" target="_blank" rel="noopener noreferrer">wangliang181230</a></li><li><a href="https://github.com/funky-eyes" target="_blank" rel="noopener noreferrer">funky-eyes</a></li><li><a href="https://github.com/tuwenlin" target="_blank" rel="noopener noreferrer">tuwenlin</a></li><li><a href="https://github.com/conghuhu" target="_blank" rel="noopener noreferrer">conghuhu</a></li><li><a href="https://github.com/a1104321118" target="_blank" rel="noopener noreferrer">a1104321118</a></li><li><a href="https://github.com/duanqiaoyanyu" target="_blank" rel="noopener noreferrer">duanqiaoyanyu</a></li><li><a href="https://github.com/robynron" target="_blank" rel="noopener noreferrer">robynron</a></li><li><a href="https://github.com/lcmvs" target="_blank" rel="noopener noreferrer">lcmvs</a></li><li><a href="https://github.com/github-ganyu" target="_blank" rel="noopener noreferrer">github-ganyu</a></li><li><a href="https://github.com/1181954449" target="_blank" rel="noopener noreferrer">1181954449</a></li><li><a href="https://github.com/zw201913" target="_blank" rel="noopener noreferrer">zw201913</a></li><li><a href="https://github.com/wingchi-leung" target="_blank" rel="noopener noreferrer">wingchi-leung</a></li><li><a href="https://github.com/AlexStocks" target="_blank" rel="noopener noreferrer">AlexStocks</a></li><li><a href="https://github.com/liujunlin5168" target="_blank" rel="noopener noreferrer">liujunlin5168</a></li><li><a href="https://github.com/pengten" target="_blank" rel="noopener noreferrer">pengten</a></li><li><a href="https://github.com/liuqiufeng" target="_blank" rel="noopener noreferrer">liuqiufeng</a></li><li><a href="https://github.com/yujianfei1986" target="_blank" rel="noopener noreferrer">yujianfei1986</a></li><li><a href="https://github.com/Bughue" target="_blank" rel="noopener noreferrer">Bughue</a></li><li><a href="https://github.com/AlbumenJ" target="_blank" rel="noopener noreferrer">AlbumenJ</a></li><li><a href="https://github.com/doubleDimple" target="_blank" rel="noopener noreferrer">doubleDimple</a></li><li><a href="https://github.com/jsbxyyx" target="_blank" rel="noopener noreferrer">jsbxyyx</a></li><li><a href="https://github.com/tuwenlin" target="_blank" rel="noopener noreferrer">tuwenlin</a></li><li><a href="https://github.com/JavaLionLi" target="_blank" rel="noopener noreferrer">CrazyLionLi</a></li><li><a href="https://github.com/whxxxxx" target="_blank" rel="noopener noreferrer">whxxxxx</a></li><li><a href="https://github.com/neillee95" target="_blank" rel="noopener noreferrer">neillee95</a></li><li><a href="https://github.com/crazy-sheep" target="_blank" rel="noopener noreferrer">crazy-sheep</a></li><li><a href="https://github.com/zhangzq7" target="_blank" rel="noopener noreferrer">zhangzq7</a></li><li><a href="https://github.com/l81893521" target="_blank" rel="noopener noreferrer">l81893521</a></li><li><a href="https://github.com/zhuyoufeng" target="_blank" rel="noopener noreferrer">zhuyoufeng</a></li><li><a href="https://github.com/xingfudeshi" target="_blank" rel="noopener noreferrer">xingfudeshi</a></li><li><a href="https://github.com/odidev" target="_blank" rel="noopener noreferrer">odidev</a></li><li><a href="https://github.com/miaoxueyu" target="_blank" rel="noopener noreferrer">miaoxueyu</a></li></ul><p>同时，我们收到了社区反馈的很多有价值的issue和建议，非常感谢大家。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="link">Link<a href="#link" class="hash-link" aria-label="Link的直接链接" title="Link的直接链接">​</a></h4><ul><li><strong>Seata:</strong> <a href="https://github.com/seata/seata" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata</a></li><li><strong>Seata-Samples:</strong> <a href="https://github.com/seata/seata-samples" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-samples</a></li><li><strong>Release:</strong> <a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/releases</a></li><li><strong>WebSite:</strong> <a href="https://seata.io" target="_blank" rel="noopener noreferrer">https://seata.io</a></li></ul></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-1.5.2">Seata 1.5.2 重磅发布，支持xid负载均衡</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-12T00:00:00.000Z" itemprop="datePublished">2022年7月12日</time> · <!-- -->阅读需 3 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Seata社区</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seata-152-重磅发布支持xid负载均衡">Seata 1.5.2 重磅发布，支持xid负载均衡<a href="#seata-152-重磅发布支持xid负载均衡" class="hash-link" aria-label="Seata 1.5.2 重磅发布，支持xid负载均衡的直接链接" title="Seata 1.5.2 重磅发布，支持xid负载均衡的直接链接">​</a></h3><p>Seata 是一款开源的分布式事务解决方案，提供高性能和简单易用的分布式事务服务。</p><p><strong>seata-server 下载链接：</strong></p><p><a href="https://github.com/seata/seata/archive/v1.5.2.zip" target="_blank" rel="noopener noreferrer">source</a> |
<a href="https://github.com/seata/seata/releases/download/v1.5.2/seata-server-1.5.2.zip" target="_blank" rel="noopener noreferrer">binary</a></p><p>此版本更新如下：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="feature">feature：<a href="#feature" class="hash-link" aria-label="feature：的直接链接" title="feature：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4713" target="_blank" rel="noopener noreferrer">#4661</a>] 支持根据xid负载均衡算法</li><li>[<a href="https://github.com/seata/seata/pull/4676" target="_blank" rel="noopener noreferrer">#4676</a>] 支持Nacos作为注册中心时，server通过挂载SLB暴露服务</li><li>[<a href="https://github.com/seata/seata/pull/4642" target="_blank" rel="noopener noreferrer">#4642</a>] 支持client批量请求并行处理</li><li>[<a href="https://github.com/seata/seata/pull/4567" target="_blank" rel="noopener noreferrer">#4567</a>] 支持where条件中find_in_set函数</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bugfix">bugfix：<a href="#bugfix" class="hash-link" aria-label="bugfix：的直接链接" title="bugfix：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4515" target="_blank" rel="noopener noreferrer">#4515</a>] 修复develop分支SeataTCCFenceAutoConfiguration在客户端未使用DB时，启动抛出ClassNotFoundException的问题。</li><li>[<a href="https://github.com/seata/seata/pull/4661" target="_blank" rel="noopener noreferrer">#4661</a>] 修复控制台中使用PostgreSQL出现的SQL异常</li><li>[<a href="https://github.com/seata/seata/pull/4682" target="_blank" rel="noopener noreferrer">#4667</a>] 修复develop分支RedisTransactionStoreManager迭代时更新map的异常</li><li>[<a href="https://github.com/seata/seata/pull/4678" target="_blank" rel="noopener noreferrer">#4678</a>] 修复属性transport.enableRmClientBatchSendRequest没有配置的情况下缓存穿透的问题</li><li>[<a href="https://github.com/seata/seata/pull/4701" target="_blank" rel="noopener noreferrer">#4701</a>] 修复命令行参数丢失问题</li><li>[<a href="https://github.com/seata/seata/pull/4607" target="_blank" rel="noopener noreferrer">#4607</a>] 修复跳过全局锁校验的缺陷</li><li>[<a href="https://github.com/seata/seata/pull/4696" target="_blank" rel="noopener noreferrer">#4696</a>] 修复 oracle 存储模式时的插入问题</li><li>[<a href="https://github.com/seata/seata/pull/4726" target="_blank" rel="noopener noreferrer">#4726</a>] 修复批量发送消息时可能的NPE问题</li><li>[<a href="https://github.com/seata/seata/pull/4729" target="_blank" rel="noopener noreferrer">#4729</a>] 修复AspectTransactional.rollbackForClassName设置错误</li><li>[<a href="https://github.com/seata/seata/pull/4653" target="_blank" rel="noopener noreferrer">#4653</a>] 修复 INSERT_ON_DUPLICATE 主键为非数值异常</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="optimize">optimize：<a href="#optimize" class="hash-link" aria-label="optimize：的直接链接" title="optimize：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4650" target="_blank" rel="noopener noreferrer">#4650</a>] 修复安全漏洞</li><li>[<a href="https://github.com/seata/seata/pull/4670" target="_blank" rel="noopener noreferrer">#4670</a>] 优化branchResultMessageExecutor线程池的线程数</li><li>[<a href="https://github.com/seata/seata/pull/4662" target="_blank" rel="noopener noreferrer">#4662</a>] 优化回滚事务监控指标</li><li>[<a href="https://github.com/seata/seata/pull/4693" target="_blank" rel="noopener noreferrer">#4693</a>] 优化控制台导航栏</li><li>[<a href="https://github.com/seata/seata/pull/4700" target="_blank" rel="noopener noreferrer">#4700</a>] 修复 maven-compiler-plugin 和 maven-resources-plugin 执行失败</li><li>[<a href="https://github.com/seata/seata/pull/4711" target="_blank" rel="noopener noreferrer">#4711</a>] 分离部署时 lib 依赖</li><li>[<a href="https://github.com/seata/seata/pull/4720" target="_blank" rel="noopener noreferrer">#4720</a>] 优化pom描述</li><li>[<a href="https://github.com/seata/seata/pull/4728" target="_blank" rel="noopener noreferrer">#4728</a>] 将logback版本依赖升级至1.2.9</li><li>[<a href="https://github.com/seata/seata/pull/4745" target="_blank" rel="noopener noreferrer">#4745</a>] 发行包中支持 mysql8 driver</li><li>[<a href="https://github.com/seata/seata/pull/4626" target="_blank" rel="noopener noreferrer">#4626</a>] 使用 <code>easyj-maven-plugin</code> 插件代替 <code>flatten-maven-plugin</code>插件，以修复<code>shade</code> 插件与 <code>flatten</code> 插件不兼容的问题</li><li>[<a href="https://github.com/seata/seata/pull/4629" target="_blank" rel="noopener noreferrer">#4629</a>] 更新globalSession状态时检查更改前后的约束关系</li><li>[<a href="https://github.com/seata/seata/pull/4662" target="_blank" rel="noopener noreferrer">#4662</a>] 优化 EnhancedServiceLoader 可读性</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test">test：<a href="#test" class="hash-link" aria-label="test：的直接链接" title="test：的直接链接">​</a></h3><ul><li>[<a href="https://github.com/seata/seata/pull/4544" target="_blank" rel="noopener noreferrer">#4544</a>] 优化TransactionContextFilterTest中jackson包依赖问题</li><li>[<a href="https://github.com/seata/seata/pull/4731" target="_blank" rel="noopener noreferrer">#4731</a>] 修复 AsyncWorkerTest 和 LockManagerTest 的单测问题。</li></ul><p>非常感谢以下 contributors 的代码贡献。若有无意遗漏，请报告。</p><ul><li><a href="https://github.com/slievrly" target="_blank" rel="noopener noreferrer">slievrly</a></li><li><a href="https://github.com/pengten" target="_blank" rel="noopener noreferrer">pengten</a></li><li><a href="https://github.com/YSF-A" target="_blank" rel="noopener noreferrer">YSF-A</a></li><li><a href="https://github.com/tuwenlin" target="_blank" rel="noopener noreferrer">tuwenlin</a></li><li><a href="https://github.com/2129zxl" target="_blank" rel="noopener noreferrer">2129zxl</a></li><li><a href="https://github.com/Ifdevil" target="_blank" rel="noopener noreferrer">Ifdevil</a></li><li><a href="https://github.com/wingchi-leung" target="_blank" rel="noopener noreferrer">wingchi-leung</a></li><li><a href="https://github.com/robynron" target="_blank" rel="noopener noreferrer">liurong</a></li><li><a href="https://github.com/opelok-z" target="_blank" rel="noopener noreferrer">opelok-z</a></li><li><a href="https://github.com/funky-eyes" target="_blank" rel="noopener noreferrer">funky-eyes</a></li><li><a href="https://github.com/Smery-lxm" target="_blank" rel="noopener noreferrer">Smery-lxm</a></li><li><a href="https://github.com/lvekee" target="_blank" rel="noopener noreferrer">lvekee</a></li><li><a href="https://github.com/doubleDimple" target="_blank" rel="noopener noreferrer">doubleDimple</a></li><li><a href="https://github.com/wangliang181230" target="_blank" rel="noopener noreferrer">wangliang181230</a></li><li><a href="https://github.com/Bughue" target="_blank" rel="noopener noreferrer">Bughue</a></li><li><a href="https://github.com/AYue-94" target="_blank" rel="noopener noreferrer">AYue-94</a></li><li><a href="https://github.com/lingxiao-wu" target="_blank" rel="noopener noreferrer">lingxiao-wu</a></li><li><a href="https://github.com/caohdgege" target="_blank" rel="noopener noreferrer">caohdgege</a></li></ul><p>同时，我们收到了社区反馈的很多有价值的issue和建议，非常感谢大家。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="link">Link<a href="#link" class="hash-link" aria-label="Link的直接链接" title="Link的直接链接">​</a></h4><ul><li><strong>Seata:</strong> <a href="https://github.com/seata/seata" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata</a></li><li><strong>Seata-Samples:</strong> <a href="https://github.com/seata/seata-samples" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata-samples</a></li><li><strong>Release:</strong> <a href="https://github.com/seata/seata/releases" target="_blank" rel="noopener noreferrer">https://github.com/seata/seata/releases</a></li><li><strong>WebSite:</strong> <a href="https://seata.io" target="_blank" rel="noopener noreferrer">https://seata.io</a></li></ul></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-tcc-fence">阿里 Seata 新版本终于解决了 TCC 模式的幂等、悬挂和空回滚问题</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-25T00:00:00.000Z" itemprop="datePublished">2022年6月25日</time> · <!-- -->阅读需 14 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">朱晋君</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>今天来聊一聊阿里巴巴 Seata 新版本（1.5.1）是怎么解决 TCC 模式下的幂等、悬挂和空回滚问题的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-tcc-回顾">1 TCC 回顾<a href="#1-tcc-回顾" class="hash-link" aria-label="1 TCC 回顾的直接链接" title="1 TCC 回顾的直接链接">​</a></h2><p>TCC 模式是最经典的分布式事务解决方案，它将分布式事务分为两个阶段来执行，try 阶段对每个分支事务进行预留资源，如果所有分支事务都预留资源成功，则进入 commit 阶段提交全局事务，如果有一个节点预留资源失败则进入 cancel 阶段回滚全局事务。</p><p>以传统的订单、库存、账户服务为例，在 try 阶段尝试预留资源，插入订单、扣减库存、扣减金额，这三个服务都是要提交本地事务的，这里可以把资源转入中间表。在 commit 阶段，再把 try 阶段预留的资源转入最终表。而在 cancel 阶段，把 try 阶段预留的资源进行释放，比如把账户金额返回给客户的账户。</p><p><strong>注意：try 阶段必须是要提交本地事务的，比如扣减订单金额，必须把钱从客户账户扣掉，如果不扣掉，在 commit 阶段客户账户钱不够了，就会出问题。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-try-commit">1.1 try-commit<a href="#11-try-commit" class="hash-link" aria-label="1.1 try-commit的直接链接" title="1.1 try-commit的直接链接">​</a></h3><p>try 阶段首先进行预留资源，然后在 commit 阶段扣除资源。如下图：</p><p><img loading="lazy" alt="fence-try-commit" src="/zh-cn/assets/images/fence-try-commit-453b9a1e280200057448436ecd7eef27.png" width="501" height="681" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-try-cancel">1.2 try-cancel<a href="#12-try-cancel" class="hash-link" aria-label="1.2 try-cancel的直接链接" title="1.2 try-cancel的直接链接">​</a></h3><p>try 阶段首先进行预留资源，预留资源时扣减库存失败导致全局事务回滚，在 cancel 阶段释放资源。如下图：</p><p><img loading="lazy" alt="fence-try-cancel" src="/zh-cn/assets/images/fence-try-cancel-eafbbb62134fe4e3ed61bdc2a47461b9.png" width="501" height="681" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-tcc-优势">2 TCC 优势<a href="#2-tcc-优势" class="hash-link" aria-label="2 TCC 优势的直接链接" title="2 TCC 优势的直接链接">​</a></h2><p>TCC 模式最大的优势是效率高。TCC 模式在 try 阶段的锁定资源并不是真正意义上的锁定，而是真实提交了本地事务，将资源预留到中间态，并不需要阻塞等待，因此效率比其他模式要高。</p><p>同时 TCC 模式还可以进行如下优化：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-异步提交">2.1 异步提交<a href="#21-异步提交" class="hash-link" aria-label="2.1 异步提交的直接链接" title="2.1 异步提交的直接链接">​</a></h3><p>try 阶段成功后，不立即进入 confirm/cancel 阶段，而是认为全局事务已经结束了，启动定时任务来异步执行 confirm/cancel，扣减或释放资源，这样会有很大的性能提升。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-同库模式">2.2 同库模式<a href="#22-同库模式" class="hash-link" aria-label="2.2 同库模式的直接链接" title="2.2 同库模式的直接链接">​</a></h3><p>TCC 模式中有三个角色：</p><ul><li>TM：管理全局事务，包括开启全局事务，提交/回滚全局事务；</li><li>RM：管理分支事务；</li><li>TC: 管理全局事务和分支事务的状态。</li></ul><p>下图来自 Seata 官网：</p><p><img loading="lazy" alt="fence-fiffrent-db" src="/zh-cn/assets/images/fence-fiffrent-db-1f7a834639aa755d73fa2af435c4f042.png" width="853" height="482" class="img_ev3q"></p><p>TM 开启全局事务时，RM 需要向 TC 发送注册消息，TC 保存分支事务的状态。TM 请求提交或回滚时，TC 需要向 RM 发送提交或回滚消息。这样包含两个个分支事务的分布式事务中，TC 和 RM 之间有四次 RPC。</p><p>优化后的流程如下图：</p><p><img loading="lazy" alt="fence-same-db" src="/zh-cn/assets/images/fence-same-db-e6de622d66afae78fd17082782192b72.png" width="943" height="442" class="img_ev3q"></p><p>TC 保存全局事务的状态。TM 开启全局事务时，RM 不再需要向 TC 发送注册消息，而是把分支事务状态保存在了本地。TM 向 TC 发送提交或回滚消息后，RM 异步线程首先查出本地保存的未提交分支事务，然后向 TC 发送消息获取（本地分支事务）所在的全局事务状态，以决定是提交还是回滚本地事务。</p><p>这样优化后，RPC 次数减少了 50%，性能大幅提升。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-rm-代码示例">3 RM 代码示例<a href="#3-rm-代码示例" class="hash-link" aria-label="3 RM 代码示例的直接链接" title="3 RM 代码示例的直接链接">​</a></h2><p>以库存服务为例，RM 库存服务接口代码如下：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@LocalTCC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface StorageService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 扣减库存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param xid 全局xid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param productId 产品id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param count 数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @TwoPhaseBusinessAction(name = &quot;storageApi&quot;, commitMethod = &quot;commit&quot;, rollbackMethod = &quot;rollback&quot;, useTCCFence = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean decrease(String xid, Long productId, Integer count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 提交事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param actionContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean commit(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 回滚事务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param actionContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean rollback(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过 @LocalTCC 这个注解，RM 初始化的时候会向 TC 注册一个分支事务。在 try 阶段的方法（decrease方法）上有一个 @TwoPhaseBusinessAction 注解，这里定义了分支事务的 resourceId，commit 方法和 cancel 方法，useTCCFence 这个属性下一节再讲。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-tcc-存在问题">4 TCC 存在问题<a href="#4-tcc-存在问题" class="hash-link" aria-label="4 TCC 存在问题的直接链接" title="4 TCC 存在问题的直接链接">​</a></h2><p>TCC 模式中存在的三大问题是幂等、悬挂和空回滚。在 Seata1.5.1 版本中，增加了一张事务控制表，表名是 tcc_fence_log 来解决这个问题。而在上一节 @TwoPhaseBusinessAction 注解中提到的属性 useTCCFence 就是来指定是否开启这个机制，这个属性值默认是 false。</p><p>tcc_fence_log 建表语句如下（MySQL 语法）：</p><div class="language-SQL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SQL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE IF NOT EXISTS `tcc_fence_log`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `xid`           VARCHAR(128)  NOT NULL COMMENT &#x27;global id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `branch_id`     BIGINT        NOT NULL COMMENT &#x27;branch id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `action_name`   VARCHAR(64)   NOT NULL COMMENT &#x27;action name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `status`        TINYINT       NOT NULL COMMENT &#x27;status(tried:1;committed:2;rollbacked:3;suspended:4)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_create`    DATETIME(3)   NOT NULL COMMENT &#x27;create time&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `gmt_modified`  DATETIME(3)   NOT NULL COMMENT &#x27;update time&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PRIMARY KEY (`xid`, `branch_id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_gmt_modified` (`gmt_modified`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEY `idx_status` (`status`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE = InnoDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEFAULT CHARSET = utf8mb4;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-幂等">4.1 幂等<a href="#41-幂等" class="hash-link" aria-label="4.1 幂等的直接链接" title="4.1 幂等的直接链接">​</a></h3><p>在 commit/cancel 阶段，因为 TC 没有收到分支事务的响应，需要进行重试，这就要分支事务支持幂等。</p><p>我们看一下新版本是怎么解决的。下面的代码在 TCCResourceManager 类：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public BranchStatus branchCommit(BranchType branchType, String xid, long branchId, String resourceId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 String applicationData) throws TransactionException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCCResource tccResource = (TCCResource)tccResourceCache.get(resourceId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //省略判断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object targetTCCBean = tccResource.getTargetBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Method commitMethod = tccResource.getCommitMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //省略判断</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //BusinessActionContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BusinessActionContext businessActionContext = getBusinessActionContext(xid, branchId, resourceId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            applicationData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object[] args = this.getTwoPhaseCommitArgs(tccResource, businessActionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //注解 useTCCFence 属性是否设置为 true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Boolean.TRUE.equals(businessActionContext.getActionContext(Constants.USE_TCC_FENCE))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result = TCCFenceHandler.commitFence(commitMethod, targetTCCBean, xid, branchId, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (SkipCallbackWrapperException | UndeclaredThrowableException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw e.getCause();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        LOGGER.info(&quot;TCC resource commit result : {}, xid: {}, branchId: {}, resourceId: {}&quot;, result, xid, branchId, resourceId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result ? BranchStatus.PhaseTwo_Committed : BranchStatus.PhaseTwo_CommitFailed_Retryable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return BranchStatus.PhaseTwo_CommitFailed_Retryable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的代码可以看到，执行分支事务提交方法时，首先判断 useTCCFence 属性是否为 true，如果为 true，则走 TCCFenceHandler 类中的 commitFence 逻辑，否则走普通提交逻辑。</p><p>TCCFenceHandler 类中的 commitFence 方法调用了 TCCFenceHandler 类的 commitFence 方法，代码如下：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static boolean commitFence(Method commitMethod, Object targetTCCBean,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  String xid, Long branchId, Object[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return transactionTemplate.execute(status -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection conn = DataSourceUtils.getConnection(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (tccFenceDO == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new TCCFenceException(String.format(&quot;TCC fence record not exists, commit fence method failed. xid= %s, branchId= %s&quot;, xid, branchId),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        FrameworkErrorCode.RecordAlreadyExists);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (TCCFenceConstant.STATUS_COMMITTED == tccFenceDO.getStatus()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                LOGGER.info(&quot;Branch transaction has already committed before. idempotency rejected. xid: {}, branchId: {}, status: {}&quot;, xid, branchId, tccFenceDO.getStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (TCCFenceConstant.STATUS_ROLLBACKED == tccFenceDO.getStatus() || TCCFenceConstant.STATUS_SUSPENDED == tccFenceDO.getStatus()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (LOGGER.isWarnEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    LOGGER.warn(&quot;Branch transaction status is unexpected. xid: {}, branchId: {}, status: {}&quot;, xid, branchId, tccFenceDO.getStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return updateStatusAndInvokeTargetMethod(conn, commitMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_COMMITTED, status, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status.setRollbackOnly();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new SkipCallbackWrapperException(t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从代码中可以看到，提交事务时首先会判断 tcc_fence_log 表中是否已经有记录，如果有记录，则判断事务执行状态并返回。这样如果判断到事务的状态已经是 STATUS_COMMITTED，就不会再次提交，保证了幂等。如果 tcc_fence_log 表中没有记录，则插入一条记录，供后面重试时判断。</p><p>Rollback 的逻辑跟 commit 类似，逻辑在类 TCCFenceHandler 的 rollbackFence 方法。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-空回滚">4.2 空回滚<a href="#42-空回滚" class="hash-link" aria-label="4.2 空回滚的直接链接" title="4.2 空回滚的直接链接">​</a></h3><p>如下图，账户服务是两个节点的集群，在 try 阶段账户服务 1 这个节点发生了故障，try 阶段在不考虑重试的情况下，全局事务必须要走向结束状态，这样就需要在账户服务上执行一次 cancel 操作。</p><p><img loading="lazy" alt="fence-empty-rollback" src="/zh-cn/assets/images/fence-empty-rollback-55e0c44f8e67d5df91c0f930860baa1f.png" width="591" height="681" class="img_ev3q"></p><p>Seata 的解决方案是在 try 阶段 往 tcc_fence_log  表插入一条记录，status 字段值是 STATUS_TRIED，在 Rollback 阶段判断记录是否存在，如果不存在，则不执行回滚操作。代码如下：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//TCCFenceHandler 类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static Object prepareFence(String xid, Long branchId, String actionName, Callback&lt;Object&gt; targetCallback) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return transactionTemplate.execute(status -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection conn = DataSourceUtils.getConnection(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_TRIED);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LOGGER.info(&quot;TCC fence prepare result: {}. xid: {}, branchId: {}&quot;, result, xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (result) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return targetCallback.execute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new TCCFenceException(String.format(&quot;Insert tcc fence record error, prepare fence failed. xid= %s, branchId= %s&quot;, xid, branchId),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        FrameworkErrorCode.InsertRecordError);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (TCCFenceException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 Rollback 阶段的处理逻辑如下:</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//TCCFenceHandler 类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static boolean rollbackFence(Method rollbackMethod, Object targetTCCBean,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    String xid, Long branchId, Object[] args, String actionName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return transactionTemplate.execute(status -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection conn = DataSourceUtils.getConnection(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // non_rollback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (tccFenceDO == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //不执行回滚逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (TCCFenceConstant.STATUS_ROLLBACKED == tccFenceDO.getStatus() || TCCFenceConstant.STATUS_SUSPENDED == tccFenceDO.getStatus()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    LOGGER.info(&quot;Branch transaction had already rollbacked before, idempotency rejected. xid: {}, branchId: {}, status: {}&quot;, xid, branchId, tccFenceDO.getStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (TCCFenceConstant.STATUS_COMMITTED == tccFenceDO.getStatus()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (LOGGER.isWarnEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        LOGGER.warn(&quot;Branch transaction status is unexpected. xid: {}, branchId: {}, status: {}&quot;, xid, branchId, tccFenceDO.getStatus());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return updateStatusAndInvokeTargetMethod(conn, rollbackMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_ROLLBACKED, status, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status.setRollbackOnly();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new SkipCallbackWrapperException(t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>updateStatusAndInvokeTargetMethod 方法执行的 sql 如下：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> tcc_fence_log </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gmt_modified </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> xid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token operator" style="color:#393A34">and</span><span class="token plain">  branch_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可见就是把 tcc_fence_log 表记录的  status  字段值从 STATUS_TRIED 改为 STATUS_ROLLBACKED，如果更新成功，就执行回滚逻辑。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-悬挂">4.3 悬挂<a href="#43-悬挂" class="hash-link" aria-label="4.3 悬挂的直接链接" title="4.3 悬挂的直接链接">​</a></h3><p>悬挂是指因为网络问题，RM 开始没有收到 try 指令，但是执行了 Rollback 后 RM 又收到了 try 指令并且预留资源成功，这时全局事务已经结束，最终导致预留的资源不能释放。如下图：</p><p><img loading="lazy" alt="fence-suspend" src="/zh-cn/assets/images/fence-suspend-054f87611ab16153c07bd28495c6902c.png" width="451" height="193" class="img_ev3q"></p><p>Seata 解决这个问题的方法是执行 Rollback 方法时先判断 tcc_fence_log 是否存在当前 xid 的记录，如果没有则向 tcc_fence_log 表插入一条记录，状态是 STATUS_SUSPENDED，并且不再执行回滚操作。代码如下：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static boolean rollbackFence(Method rollbackMethod, Object targetTCCBean,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    String xid, Long branchId, Object[] args, String actionName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return transactionTemplate.execute(status -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection conn = DataSourceUtils.getConnection(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TCCFenceDO tccFenceDO = TCC_FENCE_DAO.queryTCCFenceDO(conn, xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // non_rollback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (tccFenceDO == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //插入防悬挂记录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_SUSPENDED);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return updateStatusAndInvokeTargetMethod(conn, rollbackMethod, targetTCCBean, xid, branchId, TCCFenceConstant.STATUS_ROLLBACKED, status, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而后面执行 try 阶段方法时首先会向 tcc_fence_log 表插入一条当前 xid 的记录，这样就造成了主键冲突。代码如下：</p><div class="language-Java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//TCCFenceHandler 类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static Object prepareFence(String xid, Long branchId, String actionName, Callback&lt;Object&gt; targetCallback) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return transactionTemplate.execute(status -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection conn = DataSourceUtils.getConnection(dataSource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean result = insertTCCFenceLog(conn, xid, branchId, actionName, TCCFenceConstant.STATUS_TRIED);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (TCCFenceException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (e.getErrcode() == FrameworkErrorCode.DuplicateKeyException) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                LOGGER.error(&quot;Branch transaction has already rollbacked before,prepare fence failed. xid= {},branchId = {}&quot;, xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                addToLogCleanQueue(xid, branchId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status.setRollbackOnly();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new SkipCallbackWrapperException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注意：queryTCCFenceDO 方法 sql 中使用了 for update，这样就不用担心 Rollback 方法中获取不到 tcc_fence_log 表记录而无法判断 try 阶段本地事务的执行结果了。</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-总结">5 总结<a href="#5-总结" class="hash-link" aria-label="5 总结的直接链接" title="5 总结的直接链接">​</a></h2><p>TCC 模式是分布式事务中非常重要的事务模式，但是幂等、悬挂和空回滚一直是 TCC 模式需要考虑的问题，Seata 框架在 1.5.1 版本完美解决了这些问题。</p><p>对 tcc_fence_log 表的操作也需要考虑事务的控制，Seata 使用了代理数据源，使 tcc_fence_log 表操作和 RM 业务操作在同一个本地事务中执行，这样就能保证本地操作和对 tcc_fence_log 的操作同时成功或失败。</p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/seata-tcc">深度剖析 Seata TCC 模式（一）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-18T00:00:00.000Z" itemprop="datePublished">2022年1月18日</time> · <!-- -->阅读需 15 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">张乘辉</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Seata 目前支持 AT 模式、XA 模式、TCC 模式和 SAGA 模式，之前文章更多谈及的是非侵入式的 AT 模式，今天带大家认识一下同样是二阶段提交的 TCC 模式。</p><h1>什么是 TCC</h1><p>TCC 是分布式事务中的二阶段提交协议，它的全称为 Try-Confirm-Cancel，即资源预留（Try）、确认操作（Confirm）、取消操作（Cancel），他们的具体含义如下：</p><ol><li>Try：对业务资源的检查并预留；</li><li>Confirm：对业务处理进行提交，即 commit 操作，只要 Try 成功，那么该步骤一定成功；</li><li>Cancel：对业务处理进行取消，即回滚操作，该步骤回对 Try 预留的资源进行释放。</li></ol><p>TCC 是一种侵入式的分布式事务解决方案，以上三个操作都需要业务系统自行实现，对业务系统有着非常大的入侵性，设计相对复杂，但优点是 TCC
完全不依赖数据库，能够实现跨数据库、跨应用资源管理，对这些不同数据访问通过侵入式的编码方式实现一个原子操作，更好地解决了在各种复杂业务场景下的分布式事务问题。</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116160157.png" class="img_ev3q"></p><h1>Seata TCC 模式</h1><p>Seata TCC 模式跟通用型 TCC 模式原理一致，我们先来使用 Seata TCC 模式实现一个分布式事务：</p><p>假设现有一个业务需要同时使用服务 A 和服务 B 完成一个事务操作，我们在服务 A 定义该服务的一个 TCC 接口：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface TccActionOne {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @TwoPhaseBusinessAction(name = &quot;DubboTccActionOne&quot;, commitMethod = &quot;commit&quot;, rollbackMethod = &quot;rollback&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean prepare(BusinessActionContext actionContext, @BusinessActionContextParameter(paramName = &quot;a&quot;) String a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean commit(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean rollback(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同样，在服务 B 定义该服务的一个 TCC 接口：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface TccActionTwo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @TwoPhaseBusinessAction(name = &quot;DubboTccActionTwo&quot;, commitMethod = &quot;commit&quot;, rollbackMethod = &quot;rollback&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void prepare(BusinessActionContext actionContext, @BusinessActionContextParameter(paramName = &quot;b&quot;) String b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void commit(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void rollback(BusinessActionContext actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在业务所在系统中开启全局事务并执行服务 A 和服务 B 的 TCC 预留资源方法：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@GlobalTransactional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public String doTransactionCommit(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //服务A事务参与者</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccActionOne.prepare(null,&quot;one&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //服务B事务参与者</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccActionTwo.prepare(null,&quot;two&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上就是使用 Seata TCC 模式实现一个全局事务的例子，可以看出，TCC 模式同样使用 <code>@GlobalTransactional</code> 注解开启全局事务，而服务 A 和服务 B 的 TCC 接口为事务参与者，Seata 会把一个 TCC
接口当成一个 Resource，也叫 TCC Resource。</p><p>TCC 接口可以是 RPC，也可以是 JVM 内部调用，意味着一个 TCC 接口，会有发起方和调用方两个身份，以上例子，TCC 接口在服务 A 和服务 B 中是发起方，在业务所在系统中是调用方。如果该 TCC 接口为 Dubbo
RPC，那么调用方就是一个 dubbo:reference，发起方则是一个 dubbo:service。</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116161933.png" class="img_ev3q"></p><p>Seata 启动时会对 TCC 接口进行扫描并解析，如果 TCC 接口是一个发布方，则在 Seata 启动时会向 TC 注册 TCC Resource，每个 TCC Resource 都有一个资源 ID；如果 TCC
接口时一个调用方，Seata 代理调用方，与 AT 模式一样，代理会拦截 TCC 接口的调用，即每次调用 Try 方法，会向 TC 注册一个分支事务，接着才执行原来的 RPC 调用。</p><p>当全局事务决议提交/回滚时，TC 会通过分支注册的的资源 ID 回调到对应参与者服务中执行 TCC Resource 的 Confirm/Cancel 方法。</p><h1>Seata 如何实现 TCC 模式</h1><p>从上面的 Seata TCC 模型可以看出，TCC 模式在 Seata 中也是遵循 TC、TM、RM 三种角色模型的，如何在这三种角色模型中实现 TCC 模式呢？我将其主要实现归纳为资源解析、资源管理、事务处理。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="资源解析">资源解析<a href="#资源解析" class="hash-link" aria-label="资源解析的直接链接" title="资源解析的直接链接">​</a></h2><p>资源解析即是把 TCC 接口进行解析并注册，前面说过，TCC 接口可以是 RPC，也可以是 JVM 内部调用，在 Seata TCC 模块有中一个 remoting
模块，该模块专门用于解析具有 <code>TwoPhaseBusinessAction</code> 注解的 TCC 接口资源：</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116175059.png" class="img_ev3q"></p><p><code>RemotingParser</code> 接口主要有 <code>isRemoting</code>、<code>isReference</code>、<code>isService</code>、<code>getServiceDesc</code> 等方法，默认的实现为 <code>DefaultRemotingParser</code>，其余各自的
RPC 协议解析类都在 <code>DefaultRemotingParser</code> 中执行，Seata 目前已经实现了对 Dubbo、HSF、SofaRpc、LocalTCC 的 RPC 协议的解析，同时具备 SPI 可扩展性，未来欢迎大家为
Seata 提供更多的 RPC 协议解析类。</p><p>在 Seata 启动过程中，有个 <code>GlobalTransactionScanner </code> 注解进行扫描，会执行以下方法：</p><p><code>io.seata.spring.util.TCCBeanParserUtils#isTccAutoProxy</code></p><p>该方法目的是判断 bean 是否已被 TCC 代理，在过程中会先判断 bean 是否是一个 Remoting bean，如果是则调用 <code>getServiceDesc</code> 方法对 remoting bean
进行解析，同时判断如果是一个发起方，则对其进行资源注册：</p><p>io.seata.rm.tcc.remoting.parser.DefaultRemotingParser#parserRemotingServiceInfo</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public RemotingDesc parserRemotingServiceInfo(Object bean,String beanName,RemotingParser remotingParser){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RemotingDesc remotingBeanDesc=remotingParser.getServiceDesc(bean,beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(remotingBeanDesc==null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remotingServiceMap.put(beanName,remotingBeanDesc);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; interfaceClass=remotingBeanDesc.getInterfaceClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Method[]methods=interfaceClass.getMethods();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(remotingParser.isService(bean,beanName)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //service bean, registry resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object targetBean=remotingBeanDesc.getTargetBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(Method m:methods){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TwoPhaseBusinessAction twoPhaseBusinessAction=m.getAnnotation(TwoPhaseBusinessAction.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(twoPhaseBusinessAction!=null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCCResource tccResource=new TCCResource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setActionName(twoPhaseBusinessAction.name());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setTargetBean(targetBean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setPrepareMethod(m);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setCommitMethodName(twoPhaseBusinessAction.commitMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setCommitMethod(interfaceClass.getMethod(twoPhaseBusinessAction.commitMethod(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twoPhaseBusinessAction.commitArgsClasses()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setRollbackMethodName(twoPhaseBusinessAction.rollbackMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setRollbackMethod(interfaceClass.getMethod(twoPhaseBusinessAction.rollbackMethod(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twoPhaseBusinessAction.rollbackArgsClasses()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // set argsClasses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setCommitArgsClasses(twoPhaseBusinessAction.commitArgsClasses());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setRollbackArgsClasses(twoPhaseBusinessAction.rollbackArgsClasses());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // set phase two method&#x27;s keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setPhaseTwoCommitKeys(this.getTwoPhaseArgs(tccResource.getCommitMethod(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twoPhaseBusinessAction.commitArgsClasses()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResource.setPhaseTwoRollbackKeys(this.getTwoPhaseArgs(tccResource.getRollbackMethod(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    twoPhaseBusinessAction.rollbackArgsClasses()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //registry tcc resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DefaultResourceManager.get().registerResource(tccResource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }catch(Throwable t){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new FrameworkException(t,&quot;parser remoting service error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(remotingParser.isReference(bean,beanName)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //reference bean, TCC proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    remotingBeanDesc.setReference(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return remotingBeanDesc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上方法，先调用解析类 <code>getServiceDesc</code> 方法对 remoting bean 进行解析，并将解析后的 <code>remotingBeanDesc</code> 放入 本地缓存 <code>remotingServiceMap</code>
中，同时调用解析类 <code>isService</code> 方法判断是否为发起方，如果是发起方，则解析 <code>TwoPhaseBusinessAction</code> 注解内容生成一个 <code>TCCResource</code>，并对其进行资源注册。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="资源管理">资源管理<a href="#资源管理" class="hash-link" aria-label="资源管理的直接链接" title="资源管理的直接链接">​</a></h2><p><strong>1、资源注册</strong></p><p>Seata TCC 模式的资源叫 <code>TCCResource</code>，其资源管理器叫 <code>TCCResourceManager</code>，前面讲过，当解析完 TCC 接口 RPC 资源后，如果是发起方，则会对其进行资源注册：</p><p>io.seata.rm.tcc.TCCResourceManager#registerResource</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void registerResource(Resource resource){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCCResource tccResource=(TCCResource)resource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tccResourceCache.put(tccResource.getResourceId(),tccResource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    super.registerResource(tccResource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>TCCResource</code> 包含了 TCC 接口的相关信息，同时会在本地进行缓存。继续调用父类 <code>registerResource</code> 方法（封装了通信方法）向 TC 注册，TCC 资源的 resourceId 是
actionName，actionName 就是 <code>@TwoParseBusinessAction</code> 注解中的 name。</p><p><strong>2、资源提交/回滚</strong></p><p>io.seata.rm.tcc.TCCResourceManager#branchCommit</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public BranchStatus branchCommit(BranchType branchType,String xid,long branchId,String resourceId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String applicationData)throws TransactionException{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TCCResource tccResource=(TCCResource)tccResourceCache.get(resourceId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(tccResource==null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new ShouldNeverHappenException(String.format(&quot;TCC resource is not exist, resourceId: %s&quot;,resourceId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object targetTCCBean=tccResource.getTargetBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Method commitMethod=tccResource.getCommitMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(targetTCCBean==null||commitMethod==null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new ShouldNeverHappenException(String.format(&quot;TCC resource is not available, resourceId: %s&quot;,resourceId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //BusinessActionContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BusinessActionContext businessActionContext=getBusinessActionContext(xid,branchId,resourceId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    applicationData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ... </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret=commitMethod.invoke(targetTCCBean,args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ... </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result?BranchStatus.PhaseTwo_Committed:BranchStatus.PhaseTwo_CommitFailed_Retryable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }catch(Throwable t){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String msg=String.format(&quot;commit TCC resource error, resourceId: %s, xid: %s.&quot;,resourceId,xid);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGGER.error(msg,t);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return BranchStatus.PhaseTwo_CommitFailed_Retryable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当 TM 决议二阶段提交，TC 会通过分支注册的的资源 ID 回调到对应参与者（即 TCC 接口发起方）服务中执行 TCC Resource 的 Confirm/Cancel 方法。</p><p>资源管理器中会根据 resourceId 在本地缓存找到对应的 <code>TCCResource</code>，同时根据 xid、branchId、resourceId、applicationData 找到对应的 <code>BusinessActionContext</code>
上下文，执行的参数就在上下文中。最后，执行 <code>TCCResource</code> 中获取 <code>commit</code> 的方法进行二阶段提交。</p><p>二阶段回滚同理类似。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="事务处理">事务处理<a href="#事务处理" class="hash-link" aria-label="事务处理的直接链接" title="事务处理的直接链接">​</a></h2><p>前面讲过，如果 TCC 接口时一个调用方，则会使用 Seata TCC 代理对调用方进行拦截处理，并在处理调用真正的 RPC 方法前对分支进行注册。</p><p>执行方法<code>io.seata.spring.util.TCCBeanParserUtils#isTccAutoProxy</code>除了对 TCC 接口资源进行解析，还会判断 TCC 接口是否为调用方，如果是调用方则返回 true：</p><p>io.seata.spring.annotation.GlobalTransactionScanner#wrapIfNecessary</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116192544.png" class="img_ev3q"></p><p>如图，当 <code>GlobalTransactionalScanner</code> 扫描到 TCC 接口调用方（Reference）时，会使 <code>TccActionInterceptor</code> 对其进行代理拦截处理，<code>TccActionInterceptor</code>
实现 <code>MethodInterceptor</code>。</p><p>在 <code>TccActionInterceptor</code> 中还会调用 <code>ActionInterceptorHandler</code> 类型执行拦截处理逻辑，事务相关处理就在 <code>ActionInterceptorHandler#proceed</code> 方法中：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public Object proceed(Method method,Object[]arguments,String xid,TwoPhaseBusinessAction businessAction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Callback&lt;Object&gt; targetCallback)throws Throwable{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Get action context from arguments, or create a new one and then reset to arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BusinessActionContext actionContext=getOrCreateActionContextAndResetToArguments(method.getParameterTypes(),arguments);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Creating Branch Record</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String branchId=doTccActionLogStore(method,arguments,businessAction,actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ... </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return targetCallback.execute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }finally{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //to report business action context finally if the actionContext.getUpdated() is true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BusinessActionContextUtil.reportContext(actionContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }finally{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... ... </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上，在执行 TCC 接口一阶段之前，会调用 <code>doTccActionLogStore</code> 方法分支注册，同时还会将 TCC 相关信息比如参数放置在上下文，上面讲的资源提交/回滚就会用到这个上下文。</p><h1>如何控制异常</h1><p>在 TCC 模型执行的过程中，还可能会出现各种异常，其中最为常见的有空回滚、幂等、悬挂等。下面我讲下 Seata 是如何处理这三种异常的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何处理空回滚">如何处理空回滚<a href="#如何处理空回滚" class="hash-link" aria-label="如何处理空回滚的直接链接" title="如何处理空回滚的直接链接">​</a></h2><p>什么是空回滚？</p><p>空回滚指的是在一个分布式事务中，在没有调用参与方的 Try 方法的情况下，TM 驱动二阶段回滚调用了参与方的 Cancel 方法。</p><p>那么空回滚是如何产生的呢？</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116201900.png" class="img_ev3q"></p><p>如上图所示，全局事务开启后，参与者 A 分支注册完成之后会执行参与者一阶段 RPC 方法，如果此时参与者 A 所在的机器发生宕机，网络异常，都会造成 RPC 调用失败，即参与者 A 一阶段方法未成功执行，但是此时全局事务已经开启，Seata
必须要推进到终态，在全局事务回滚时会调用参与者 A 的 Cancel 方法，从而造成空回滚。</p><p>要想防止空回滚，那么必须在 Cancel 方法中识别这是一个空回滚，Seata 是如何做的呢？</p><p>Seata 的做法是新增一个 TCC 事务控制表，包含事务的 XID 和 BranchID 信息，在 Try 方法执行时插入一条记录，表示一阶段执行了，执行 Cancel 方法时读取这条记录，如果记录不存在，说明 Try 方法没有执行。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何处理幂等">如何处理幂等<a href="#如何处理幂等" class="hash-link" aria-label="如何处理幂等的直接链接" title="如何处理幂等的直接链接">​</a></h2><p>幂等问题指的是 TC 重复进行二阶段提交，因此 Confirm/Cancel 接口需要支持幂等处理，即不会产生资源重复提交或者重复释放。</p><p>那么幂等问题是如何产生的呢？</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116203816.png" class="img_ev3q"></p><p>如上图所示，参与者 A 执行完二阶段之后，由于网络抖动或者宕机问题，会造成 TC 收不到参与者 A 执行二阶段的返回结果，TC 会重复发起调用，直到二阶段执行结果成功。</p><p>Seata 是如何处理幂等问题的呢？</p><p>同样的也是在 TCC 事务控制表中增加一个记录状态的字段 status，该字段有 3 个值，分别为：</p><ol><li>tried：1</li><li>committed：2</li><li>rollbacked：3</li></ol><p>二阶段 Confirm/Cancel 方法执行后，将状态改为 committed 或 rollbacked 状态。当重复调用二阶段 Confirm/Cancel 方法时，判断事务状态即可解决幂等问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何处理悬挂">如何处理悬挂<a href="#如何处理悬挂" class="hash-link" aria-label="如何处理悬挂的直接链接" title="如何处理悬挂的直接链接">​</a></h2><p>悬挂指的是二阶段 Cancel 方法比 一阶段 Try 方法优先执行，由于允许空回滚的原因，在执行完二阶段 Cancel 方法之后直接空回滚返回成功，此时全局事务已结束，但是由于 Try 方法随后执行，这就会造成一阶段 Try
方法预留的资源永远无法提交和释放了。</p><p>那么悬挂是如何产生的呢？</p><p><img loading="lazy" src="https://gitee.com/objcoding/md-picture/raw/master/img/20220116205241.png" class="img_ev3q"></p><p>如上图所示，在执行参与者 A 的一阶段 Try 方法时，出现网路拥堵，由于 Seata 全局事务有超时限制，执行 Try 方法超时后，TM 决议全局回滚，回滚完成后如果此时 RPC 请求才到达参与者 A，执行 Try
方法进行资源预留，从而造成悬挂。</p><p>Seata 是怎么处理悬挂的呢？</p><p>在 TCC 事务控制表记录状态的字段 status 中增加一个状态：</p><ol><li>suspended：4</li></ol><p>当执行二阶段 Cancel 方法时，如果发现 TCC 事务控制表没有相关记录，说明二阶段 Cancel 方法优先一阶段 Try 方法执行，因此插入一条 status=4 状态的记录，当一阶段 Try 方法后面执行时，判断 status=4 ，则说明有二阶段 Cancel 已执行，并返回 false 以阻止一阶段 Try 方法执行成功。</p><h1>作者简介</h1><p>张乘辉，目前就职于蚂蚁集团，热爱分享技术，微信公众号「后端进阶」作者，技术博客（<a href="https://objcoding.com/" target="_blank" rel="noopener noreferrer">https://objcoding.com/</a>）博主，Seata Committer，GitHub
ID：objcoding。</p></div><footer class="row docusaurus-mt-lg"></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/blog/page/2"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/zh-cn/img/apache/incubator.svg" alt="Apache Incubator Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/zh-cn/img/apache/incubator.svg" alt="Apache Incubator Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">
                  <div class="fs-12">
                    <div class="center-div">
                      <span>Apache Seata is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</span>
                    </div>
                    <br>
                    <div class="center-div">
                      <span>Copyright © 2023-2024, The Apache Software Foundation Apache Seata, Seata, Apache, Apache Incubator, the Apache feather, the Apache Incubator logo and the Apache Seata project logo are either registered trademarks or trademarks of the Apache Software Foundation.</span>
                      <br>
                    </div>
                    <br>
                  </div>
                  </div></div></div></footer></div>
<script src="/zh-cn/assets/js/runtime~main.6f01168c.js"></script>
<script src="/zh-cn/assets/js/main.603a6742.js"></script>
</body>
</html>