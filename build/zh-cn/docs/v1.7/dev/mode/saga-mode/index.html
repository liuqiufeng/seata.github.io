<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v1.7 plugin-docs plugin-id-default docs-doc-id-dev/mode/saga-mode">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Seata SAGA 模式 | Seata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://seata.io/seata.github.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://seata.io/seata.github.io/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://seata.io/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="v1.7"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.7"><meta data-rh="true" name="docsearch:version" content="v1.7"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.7"><meta data-rh="true" property="og:title" content="Seata SAGA 模式 | Seata"><meta data-rh="true" name="description" content="Saga模式是SEATA提供的长事务解决方案，在Saga模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务都由业务开发实现。"><meta data-rh="true" property="og:description" content="Saga模式是SEATA提供的长事务解决方案，在Saga模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务都由业务开发实现。"><meta data-rh="true" name="keywords" content="Seata"><link data-rh="true" rel="icon" href="/seata.github.io/zh-cn/img/seata_logo_small.jpeg"><link data-rh="true" rel="canonical" href="https://seata.io/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode"><link data-rh="true" rel="alternate" href="https://seata.io/seata.github.io/docs/v1.7/dev/mode/saga-mode" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://seata.io/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://seata.io/seata.github.io/docs/v1.7/dev/mode/saga-mode" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ICHFIJRDZF-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/seata.github.io/zh-cn/blog/rss.xml" title="Seata RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/seata.github.io/zh-cn/blog/atom.xml" title="Seata Atom Feed">


<link rel="search" type="application/opensearchdescription+xml" title="Seata" href="/seata.github.io/zh-cn/opensearch.xml">


<meta name="aes-config" content="pid=xux-opensource&amp;user_type=101&amp;uid=&amp;username=&amp;dim10=seata">
<script src="https://www.googletagmanager.com/gtag/js?id=G-X4LJGF90X2" async></script><link rel="stylesheet" href="/seata.github.io/zh-cn/assets/css/styles.d0073205.css">
<link rel="preload" href="/seata.github.io/zh-cn/assets/js/runtime~main.e3c607df.js" as="script">
<link rel="preload" href="/seata.github.io/zh-cn/assets/js/main.448a9560.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>



<script src="https://hm.baidu.com/hm.js?104e73ef0c18b416b27abb23757ed8ee"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/seata.github.io/zh-cn/"><div class="navbar__logo"><img src="/seata.github.io/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/seata.github.io/zh-cn/img/seata_logo.png" alt="Seata Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/">首页</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/overview/what-is-seata" href="/seata.github.io/zh-cn/docs/v1.7/overview/what-is-seata">v1.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/next/dev/mode/saga-mode">预览版</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/dev/mode/saga-mode">v2.0</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.8/dev/mode/saga-mode">v1.8</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode">v1.7</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.6/dev/mode/saga-mode">v1.6</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.5/dev/mode/saga-mode">v1.5</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.4/dev/mode/saga-mode">v1.4</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.3/dev/mode/saga-mode">v1.3</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.2/dev/mode/saga-mode">v1.2</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.1/dev/mode/saga-mode">v1.1</a></li><li><a class="dropdown__link" href="/seata.github.io/zh-cn/docs/v1.0/dev/mode/saga-mode">v1.0</a></li></ul></div><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/docs/v1.7/developers/contributor-guide/new-contributor-guide_dev">开发者</a><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/blog">博客</a><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/users">用户</a><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/community">社区</a><a class="navbar__item navbar__link" href="/seata.github.io/zh-cn/unversioned/download/seata-server">下载</a><a href="http://demo.seata.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">控制台样例</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中</a><ul class="dropdown__menu"><li><a href="/seata.github.io/docs/v1.7/dev/mode/saga-mode" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">En</a></li><li><a href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">概述</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/overview/what-is-seata">Seata 是什么？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/overview/terminology">Seata术语表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/overview/faq">FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">用户文档</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/quickstart">快速启动</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/configurations">参数配置</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/mode/at">各事务模式</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/txgroup/transaction-group">事务分组</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/configuration/">配置中心</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/registry/">注册中心</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/api">API 支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/microservice">微服务框架支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/ormframework">ORM框架支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/datasource">数据库类型支持</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/sqlreference/sql-restrictions">SQL参考</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/apm/skywalking">应用性能监控</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/performance">测试报告</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/user/appendix/global-transaction-status">附录</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">开发者指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/at-mode">各事务模式</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/at-mode">Seata AT 模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/tcc-mode">Seata TCC 模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/saga-mode">Seata SAGA 模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/xa-mode">Seata XA 模式</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/domain/overviewDomainModel">领域模型</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/dev/seata-mertics">Metrics 设计</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">运维指南</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/ops/upgrade">版本升级指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/ops/multi-configuration-isolation">多配置隔离</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/seata.github.io/zh-cn/docs/v1.7/ops/deploy-guide-beginner">部署</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>此为 <!-- -->Seata<!-- --> <b>v1.7</b> 版的文档，现已不再积极维护。</div><div class="margin-top--md">最新的文档请参阅 <b><a href="/seata.github.io/zh-cn/docs/dev/mode/saga-mode">最新版本</a></b> (<!-- -->v2.0<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/seata.github.io/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">开发者指南</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">各事务模式</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Seata SAGA 模式</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v1.7</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>SEATA Saga 模式</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h2><p>Saga模式是SEATA提供的长事务解决方案，在Saga模式中，业务流程中每个参与者都提交本地事务，当出现某一个参与者失败则补偿前面已经成功的参与者，一阶段正向服务和二阶段补偿服务都由业务开发实现。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1Y2kuw7T2gK0jSZFkXXcIQFXa-445-444.png" alt="Saga模式示意图" class="img_ev3q"></p><p>理论基础：Hector &amp; Kenneth 发表论⽂ Sagas （1987）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saga的实现">Saga的实现：<a href="#saga的实现" class="hash-link" aria-label="Saga的实现：的直接链接" title="Saga的实现：的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于状态机引擎的-saga-实现">基于状态机引擎的 Saga 实现：<a href="#基于状态机引擎的-saga-实现" class="hash-link" aria-label="基于状态机引擎的 Saga 实现：的直接链接" title="基于状态机引擎的 Saga 实现：的直接链接">​</a></h3><p>目前SEATA提供的Saga模式是基于状态机引擎来实现的，机制是：</p><ol><li>通过状态图来定义服务调用的流程并生成 json 状态语言定义文件</li><li>状态图中一个节点可以是调用一个服务，节点可以配置它的补偿节点</li><li>状态图 json 由状态机引擎驱动执行，当出现异常时状态引擎反向执行已成功节点对应的补偿节点将事务回滚<blockquote><p>注意: 异常发生时是否进行补偿也可由用户自定义决定</p></blockquote></li><li>可以实现服务编排需求，支持单项选择、并发、子流程、参数转换、参数映射、服务执行状态判断、异常捕获等功能</li></ol><p>示例状态图:</p><p><img loading="lazy" alt="示例状态图" src="/seata.github.io/zh-cn/assets/images/demo_statelang-90f1fc01bfaf3a795c3b3357e1046f16.png" width="508" height="543" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设计">设计<a href="#设计" class="hash-link" aria-label="设计的直接链接" title="设计的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="状态机引擎原理">状态机引擎原理:<a href="#状态机引擎原理" class="hash-link" aria-label="状态机引擎原理:的直接链接" title="状态机引擎原理:的直接链接">​</a></h3><p><img loading="lazy" alt="状态机引擎原理" src="/seata.github.io/zh-cn/assets/images/saga_engine_mechanism-38f1563ee8316a5dcabeeba27f511f79.png" width="936" height="672" class="img_ev3q"></p><ul><li>图中的状态图是先执行stateA, 再执行stateB，然后执行stateC</li><li>&quot;状态&quot;的执行是基于事件驱动的模型，stateA执行完成后，会产生路由消息放入EventQueue，事件消费端从EventQueue取出消息，执行stateB</li><li>在整个状态机启动时会调用Seata Server开启分布式事务，并生产xid, 然后记录&quot;状态机实例&quot;启动事件到本地数据库</li><li>当执行到一个&quot;状态&quot;时会调用Seata Server注册分支事务，并生产branchId, 然后记录&quot;状态实例&quot;开始执行事件到本地数据库</li><li>当一个&quot;状态&quot;执行完成后会记录&quot;状态实例&quot;执行结束事件到本地数据库, 然后调用Seata Server上报分支事务的状态</li><li>当整个状态机执行完成, 会记录&quot;状态机实例&quot;执行完成事件到本地数据库, 然后调用Seata Server提交或回滚分布式事务</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="状态机引擎设计">状态机引擎设计:<a href="#状态机引擎设计" class="hash-link" aria-label="状态机引擎设计:的直接链接" title="状态机引擎设计:的直接链接">​</a></h3><p><img loading="lazy" alt="状态机引擎设计" src="/seata.github.io/zh-cn/assets/images/saga_engine-41e75396b108b8e6c157d08766368124.png" width="1044" height="702" class="img_ev3q"></p><p>状态机引擎的设计主要分成三层, 上层依赖下层，从下往上分别是：</p><ul><li>Eventing 层:<ul><li>实现事件驱动架构, 可以压入事件, 并由消费端消费事件, 本层不关心事件是什么消费端执行什么，由上层实现</li></ul></li><li>ProcessController 层:<ul><li>由于上层的Eventing驱动一个“空”流程引擎的执行，&quot;state&quot;的行为和路由都未实现, 由上层实现<blockquote><p>基于以上两层理论上可以自定义扩展任何&quot;流程&quot;引擎</p></blockquote></li></ul></li><li>StateMachineEngine 层:<ul><li>实现状态机引擎每种state的行为和路由逻辑</li><li>提供 API、状态机语言仓库</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="状态机的高可用设计">状态机的高可用设计：<a href="#状态机的高可用设计" class="hash-link" aria-label="状态机的高可用设计：的直接链接" title="状态机的高可用设计：的直接链接">​</a></h3><p><img loading="lazy" alt="状态机的高可用" src="/seata.github.io/zh-cn/assets/images/SagaEngineHA-d538cf16094433b07ec905b5c0746fdb.png" width="728" height="656" class="img_ev3q"></p><p>状态机引擎是无状态的，它是内嵌在应用中。</p><p>当应用正常运行时（图中上半部分）：</p><ul><li>状态机引擎会上报状态到Seata Server；</li><li>状态机执行日志存储在业务的数据库中；</li></ul><p>当一台应用实例宕机时（图中下半部分）：</p><ul><li>Seata Server 会感知到，并发送事务恢复请求到还存活的应用实例；</li><li>状态机引擎收到事务恢复请求后，从数据库里装载日志，并恢复状态机上下文继续执行；</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/incubator-seata-website/blob/docusaurus/i18n/zh-cn/docusaurus-plugin-content-docs/version-v1.7/dev/mode/saga-mode.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/tcc-mode"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Seata TCC 模式</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/seata.github.io/zh-cn/docs/v1.7/dev/mode/xa-mode"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Seata XA 模式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#saga的实现" class="table-of-contents__link toc-highlight">Saga的实现：</a><ul><li><a href="#基于状态机引擎的-saga-实现" class="table-of-contents__link toc-highlight">基于状态机引擎的 Saga 实现：</a></li></ul></li><li><a href="#设计" class="table-of-contents__link toc-highlight">设计</a><ul><li><a href="#状态机引擎原理" class="table-of-contents__link toc-highlight">状态机引擎原理:</a></li><li><a href="#状态机引擎设计" class="table-of-contents__link toc-highlight">状态机引擎设计:</a></li><li><a href="#状态机的高可用设计" class="table-of-contents__link toc-highlight">状态机的高可用设计：</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/seata.github.io/zh-cn/img/apache/incubator.svg" alt="Apache Incubator Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/seata.github.io/zh-cn/img/apache/incubator.svg" alt="Apache Incubator Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">
                  <div class="fs-12">
                    <div class="center-div">
                      <span>Apache Seata is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</span>
                    </div>
                    <br>
                    <div class="center-div">
                      <span>Copyright © 2023-2024, The Apache Software Foundation Apache Seata, Seata, Apache, Apache Incubator, the Apache feather, the Apache Incubator logo and the Apache Seata project logo are either registered trademarks or trademarks of the Apache Software Foundation.</span>
                      <br>
                    </div>
                    <br>
                  </div>
                  </div></div></div></footer></div>
<script src="/seata.github.io/zh-cn/assets/js/runtime~main.e3c607df.js"></script>
<script src="/seata.github.io/zh-cn/assets/js/main.448a9560.js"></script>
</body>
</html>